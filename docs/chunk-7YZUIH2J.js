import{b as we,d as be}from"./chunk-GWF3Y4XC.js";import{a as Ie,b as Pe,c as Ce,d as Oe,e as Me,f as Ee,g as De}from"./chunk-BHMDDMEQ.js";import{a as Te}from"./chunk-TTXQ7DPJ.js";import{$ as v,Aa as Z,Ea as ce,Eb as ge,Fb as fe,Gb as ye,Hb as xe,Ia as y,Ib as he,J as H,Na as pe,Oa as c,Pa as A,Qa as I,Qb as Se,Ra as N,Sa as r,Ta as a,Ua as E,Va as me,Wa as ue,Xa as C,Ya as g,Za as _,_ as u,a as k,b as Q,bb as ae,c as _e,cb as l,db as M,eb as S,fb as D,gb as oe,hb as X,ib as ee,jb as te,l as R,nb as W,ob as G,pb as se,r as J,rb as ve,ua as F,wa as s,x as re,y as le}from"./chunk-UUM5BDCX.js";function $e(o,n){o&1&&(r(0,"p",23),l(1,"Loading Inventory..."),a())}function Ue(o,n){o&1&&(r(0,"p",23),l(1,"Loading Missing Parts..."),a())}function Fe(o,n){if(o&1&&(r(0,"div",17)(1,"div",18),E(2,"div",19),y(3,$e,2,0,"p",20)(4,Ue,2,0,"p",20),r(5,"p",21),l(6,"Loading large datasets may take a moment"),a(),r(7,"p",22),l(8,"Processing CSV files and building cache..."),a()()()),o&2){let e=_();s(3),c("ngIf",!e.isMissingPartsMode),s(),c("ngIf",e.isMissingPartsMode)}}function Ae(o,n){o&1&&(r(0,"div",24)(1,"h1",25),l(2,"Inventory Not Found"),a(),r(3,"p",26),l(4,"The inventory you're looking for does not exist or has been removed."),a(),r(5,"a",27),l(6," Back to Sets "),a()())}function Qe(o,n){o&1&&(r(0,"div",28)(1,"div",29)(2,"h1",30),l(3,"Missing Parts"),a(),r(4,"p",31),l(5,"You don't have any sets in your inventory yet."),a(),r(6,"a",27),l(7," Browse Sets "),a()()())}function je(o,n){o&1&&(r(0,"div",28)(1,"div",29)(2,"h1",30),l(3,"Missing Parts"),a(),r(4,"p",31),l(5,"You have all parts for your sets. Great job!"),a(),r(6,"a",27),l(7," View My Sets "),a()()())}function Be(o,n){if(o&1){let e=C();r(0,"div",54)(1,"div",55),g("click",function(){u(e);let t=_(3);return v(t.openImageOverlay((t.set==null?null:t.set.img_url)||"",(t.set==null?null:t.set.name)||"Set image"))}),r(2,"img",56),g("error",function(t){u(e);let d=_(3);return v(d.onImageError(t))}),a()(),r(3,"div",57)(4,"p",58),l(5," Image \xA9 "),r(6,"a",59),l(7,"Rebrickable"),a()()()()}if(o&2){let e=_(3);s(2),c("src",(e.set==null?null:e.set.img_url)||"",F)("alt",(e.set==null?null:e.set.name)||"Set image")}}function Le(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(3);s(),S("Year: ",e.set==null?null:e.set.year,"")}}function ze(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(3);s(),S("Theme: ",e.theme==null?null:e.theme.name,"")}}function Ke(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(3);s(),S("Parts: ",e.set==null?null:e.set.num_parts,"")}}function Re(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(3);s(),S("Colors: ",e.uniqueColorsCount,"")}}function He(o,n){if(o&1&&(r(0,"div")(1,"div",60)(2,"span"),l(3,"Overall Progress"),a(),r(4,"span"),l(5),W(6,"number"),a()(),r(7,"div",61),E(8,"div",62),a()()),o&2){let e=_(3);s(5),oe("",e.totalPartsOwned+e.totalSparePartsOwned+e.totalMinifigsOwned," / ",e.totalPartsNeeded+e.totalSparePartsNeeded+e.totalMinifigsNeeded," items (",G(6,11,e.overallProgress,"1.1-1"),"%)"),s(3),A("width",e.overallProgress,"%"),I("bg-green-500",e.overallProgress>=100)("bg-yellow-500",e.overallProgress>0&&e.overallProgress<100)("bg-red-500",e.overallProgress===0)}}function We(o,n){if(o&1&&(r(0,"div")(1,"div",64)(2,"span"),l(3,"Spare Parts Progress"),a(),r(4,"span"),l(5),W(6,"number"),a()(),r(7,"div",65),E(8,"div",66),a()()),o&2){let e=_(4);s(5),oe("",e.totalSparePartsOwned," / ",e.totalSparePartsNeeded," items (",e.totalSparePartsNeeded>0?e.totalSparePartsOwned/e.totalSparePartsNeeded*100:G(6,11,0,"1.1-1"),"%)"),s(3),A("width",e.totalSparePartsNeeded>0?e.totalSparePartsOwned/e.totalSparePartsNeeded*100:0,"%"),I("bg-green-400",e.totalSparePartsOwned>=e.totalSparePartsNeeded)("bg-yellow-400",e.totalSparePartsOwned>0&&e.totalSparePartsOwned<e.totalSparePartsNeeded)("bg-red-400",e.totalSparePartsOwned===0)}}function Ge(o,n){if(o&1&&(r(0,"div")(1,"div",63)(2,"div")(3,"div",60)(4,"span"),l(5,"Main Progress (Parts + Minifigures)"),a(),r(6,"span"),l(7),W(8,"number"),a()(),r(9,"div",61),E(10,"div",62),a()(),y(11,We,9,14,"div",39),a()()),o&2){let e=_(3);s(7),oe("",e.totalPartsOwned+e.totalMinifigsOwned," / ",e.totalPartsNeeded+e.totalMinifigsNeeded," items (",G(8,12,e.overallProgress,"1.1-1"),"%)"),s(3),A("width",e.overallProgress,"%"),I("bg-green-500",e.overallProgress>=100)("bg-yellow-500",e.overallProgress>0&&e.overallProgress<100)("bg-red-500",e.overallProgress===0),s(),c("ngIf",e.totalSparePartsNeeded>0)}}function Ye(o,n){if(o&1&&(r(0,"div",41)(1,"div",42),y(2,Be,8,2,"div",43),r(3,"div",44)(4,"h1",45),l(5),a(),r(6,"p",46),l(7),a(),r(8,"p",46),l(9),a(),r(10,"div",47),y(11,Le,2,1,"span",39)(12,ze,2,1,"span",39)(13,Ke,2,1,"span",39)(14,Re,2,1,"span",39),a(),r(15,"p",48),l(16),W(17,"date"),a(),r(18,"div",49),y(19,He,9,14,"div",39)(20,Ge,12,15,"div",39),a()()(),r(21,"div",50)(22,"a",51)(23,"span",52),l(24,"\u{1F517}"),a(),l(25," View on Rebrickable "),a(),r(26,"a",53),l(27,"Back to Sets"),a()()()),o&2){let e=_(2);s(2),c("ngIf",e.set==null?null:e.set.img_url),s(3),M(e.userInventory==null?null:e.userInventory.name),s(2),S("Set #: ",e.userInventory==null?null:e.userInventory.set_num,""),s(2),S("Version: ",e.userInventory==null?null:e.userInventory.version,""),s(2),c("ngIf",e.set==null?null:e.set.year),s(),c("ngIf",e.theme==null?null:e.theme.name),s(),c("ngIf",e.set==null?null:e.set.num_parts),s(),c("ngIf",e.uniqueColorsCount>0),s(2),S("Last updated: ",G(17,12,e.userInventory==null?null:e.userInventory.lastUpdated,"medium"),""),s(3),c("ngIf",e.globalSettings.includeSparePartsInProgress),s(),c("ngIf",!e.globalSettings.includeSparePartsInProgress),s(2),c("href","https://rebrickable.com/sets/"+(e.userInventory==null?null:e.userInventory.set_num),F)}}function Je(o,n){if(o&1&&(r(0,"div",67)(1,"div",68)(2,"div",44)(3,"h1",69),l(4,"Missing Parts"),a(),r(5,"p",70),l(6,"Track which parts and minifigures you still need for your building block sets"),a(),r(7,"p",71),l(8),a()(),r(9,"div",72)(10,"a",53),l(11,"Back to Sets"),a()()()()),o&2){let e=_(2);s(8),D("Showing missing items from ",e.userInventories.length," set",e.userInventories.length!==1?"s":"","")}}function Ze(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(2);s(),D("Parts (",e.totalPartsOwned,"/",e.totalPartsNeeded,")")}}function Xe(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(2);s(),S("Missing Parts (",e.parts.length,")")}}function et(o,n){if(o&1&&(r(0,"span",73),l(1),a()),o&2){let e=_(2);s(),S("",e.missingPartsCount," missing")}}function tt(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(2);s(),D("Spare Parts (",e.totalSparePartsOwned,"/",e.totalSparePartsNeeded,")")}}function it(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(2);s(),S("Missing Spare Parts (",e.spareParts.length,")")}}function nt(o,n){if(o&1&&(r(0,"span",73),l(1),a()),o&2){let e=_(2);s(),S("",e.missingSparePartsCount," missing")}}function rt(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(2);s(),D("Minifigures (",e.getTotalMinifigPartsProgress().owned,"/",e.getTotalMinifigPartsProgress().total,")")}}function at(o,n){if(o&1&&(r(0,"span"),l(1),a()),o&2){let e=_(2);s(),S("Missing Minifigures (",e.minifigs.length,")")}}function ot(o,n){if(o&1&&(r(0,"span",73),l(1),a()),o&2){let e=_(2);s(),S("",e.getTotalMinifigPartsProgress().missing," parts missing")}}function st(o,n){if(o&1&&(r(0,"option",101),l(1),a()),o&2){let e=n.$implicit,i=_().index,t=_(4);c("value",e.value)("disabled",t.isFieldDisabled("parts",e.value,i)),s(),S(" ",e.label," ")}}function lt(o,n){if(o&1){let e=C();r(0,"button",102),g("click",function(){u(e);let t=_().index,d=_(4);return v(d.removeSortOption("parts",t))}),l(1," \u2715 "),a()}}function dt(o,n){if(o&1){let e=C();r(0,"div",93)(1,"span",94),l(2),a(),r(3,"select",95),te("ngModelChange",function(t){let d=u(e).$implicit;return ee(d.field,t)||(d.field=t),v(t)}),g("ngModelChange",function(t){let d=u(e),p=d.$implicit,m=d.index,f=_(4);return v(f.updateSortOption("parts",m,t,p.direction))}),y(4,st,2,3,"option",96),a(),r(5,"select",97),g("change",function(t){let d=u(e),p=d.$implicit,m=d.index,f=_(4);return v(f.updateSortOption("parts",m,p.field,t.target.value))}),r(6,"option",98),l(7,"Ascending"),a(),r(8,"option",99),l(9,"Descending"),a()(),y(10,lt,2,0,"button",100),a()}if(o&2){let e=n.$implicit,i=n.index,t=_(4);s(2),S("",i+1,"."),s(),X("ngModel",e.field),s(),c("ngForOf",t.getAllFieldsForDropdown("parts")),s(),c("value",e.direction),s(5),c("ngIf",t.partsSortOptions.length>1)}}function _t(o,n){if(o&1){let e=C();r(0,"div",103)(1,"button",104),g("click",function(){u(e);let t=_(4);return v(t.addSortOption("parts"))}),l(2," + Add Sort Criteria "),a()()}}function ct(o,n){if(o&1){let e=C();r(0,"div",84)(1,"div",85)(2,"h3",86),l(3,"Sort Parts"),a(),r(4,"button",87),g("click",function(){u(e);let t=_(3);return v(t.resetToDefaultSort())}),l(5," Reset to Default "),a()(),r(6,"div",63),y(7,dt,11,5,"div",88)(8,_t,3,0,"div",89),a(),r(9,"div",90)(10,"button",91),g("click",function(){u(e);let t=_(3);return v(t.closeSortOptions())}),l(11," Cancel "),a(),r(12,"button",92),g("click",function(){u(e);let t=_(3);return v(t.applySortChanges())}),l(13," Apply Sort "),a()()()}if(o&2){let e=_(3);s(7),c("ngForOf",e.partsSortOptions),s(),c("ngIf",e.partsSortOptions.length<3)}}function pt(o,n){if(o&1&&(r(0,"p",114),l(1),a()),o&2){let e=_().$implicit;s(),S("Element ID: ",e.elementId,"")}}function mt(o,n){if(o&1&&(r(0,"p",128),l(1),a()),o&2){let e=_().$implicit;s(),D("From: ",e.setName," (",e.setNum,")")}}function ut(o,n){o&1&&(r(0,"span"),l(1,"\u2713 Complete"),a())}function vt(o,n){o&1&&(r(0,"span"),l(1,"\u26A0 Partial"),a())}function gt(o,n){o&1&&(r(0,"span"),l(1,"\u2717 Missing"),a())}function ft(o,n){if(o&1){let e=C();r(0,"div",109)(1,"div",110)(2,"div")(3,"div",111),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.openImageOverlay(t.imageUrl,t.part.name))}),E(4,"img",112),a(),r(5,"div")(6,"h3",113),l(7),a(),r(8,"p",114),l(9),a(),r(10,"p",114),l(11),a(),y(12,pt,2,1,"p",115)(13,mt,2,2,"p",116),a()(),r(14,"div",117)(15,"div",60)(16,"span"),l(17,"Progress"),a(),r(18,"span"),l(19),a()(),r(20,"div",65),E(21,"div",66),a()(),r(22,"div",118)(23,"label",119),l(24,"Owned:"),a(),r(25,"div",120)(26,"button",121),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityOwned-1))}),l(27," - "),a(),r(28,"input",122),g("input",function(t){let d=u(e).$implicit,p=_(5);return v(p.updatePartQuantity(d,+t.target.value))})("focus",function(t){return u(e),v(t.target.select())}),a(),r(29,"button",121),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityOwned+1))}),l(30," + "),a()(),r(31,"span",21),l(32),a()(),r(33,"div",123)(34,"button",124),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityNeeded))}),l(35," \u2713 "),a(),r(36,"button",125),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,0))}),l(37," \u2717 "),a()(),r(38,"div",126)(39,"span",127),y(40,ut,2,0,"span",39)(41,vt,2,0,"span",39)(42,gt,2,0,"span",39),a()()()()}if(o&2){let e=n.$implicit,i=_(5);I("bg-green-50",e.quantityOwned>=e.quantityNeeded)("bg-yellow-50",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-50",e.quantityOwned===0),s(2),N(i.shouldUseVerticalLayout()?"flex flex-col items-center mb-4":"flex items-start mb-4"),s(),N(i.getImageSizeClasses()+(i.shouldUseVerticalLayout()?" mb-3 flex-shrink-0 cursor-pointer":" mr-4 flex-shrink-0 cursor-pointer")),s(),c("src",e.imageUrl,F)("alt",e.part.name),s(),N(i.shouldUseVerticalLayout()?"flex-1 text-center":"flex-1"),s(2),M(e.part.name),s(2),S("Part #: ",e.part.part_num,""),s(2),S("Color: ",e.color.name,""),s(),c("ngIf",e.elementId),s(),c("ngIf",i.isMissingPartsMode&&e.setName),s(6),D("",e.quantityOwned," / ",e.quantityNeeded,""),s(2),A("width",e.quantityOwned/e.quantityNeeded*100,"%"),I("bg-green-500",e.quantityOwned>=e.quantityNeeded)("bg-yellow-500",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-500",e.quantityOwned===0),s(5),c("disabled",e.quantityOwned<=0),s(2),c("value",e.quantityOwned)("min",0)("max",e.quantityNeeded),s(),c("disabled",e.quantityOwned>=e.quantityNeeded),s(3),S("/ ",e.quantityNeeded,""),s(2),c("disabled",e.quantityOwned>=e.quantityNeeded),s(2),c("disabled",e.quantityOwned===0),s(3),I("text-green-600",e.quantityOwned>=e.quantityNeeded)("text-yellow-600",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("text-red-600",e.quantityOwned===0),s(),c("ngIf",e.quantityOwned>=e.quantityNeeded),s(),c("ngIf",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded),s(),c("ngIf",e.quantityOwned===0)}}function yt(o,n){if(o&1&&(r(0,"div",107),y(1,ft,43,46,"div",108),a()),o&2){let e=_(4);s(),c("ngForOf",e.filteredParts)("ngForTrackBy",e.trackByPartId)}}function xt(o,n){o&1&&(r(0,"th",136),l(1,"Set"),a())}function ht(o,n){if(o&1&&(r(0,"td",148)(1,"div",146),l(2),a()()),o&2){let e=_().$implicit;s(2),D("",e.setName," (",e.setNum,")")}}function wt(o,n){if(o&1){let e=C();r(0,"tr")(1,"td",141)(2,"div",142)(3,"div",111),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.openImageOverlay(t.imageUrl,t.part.name))}),E(4,"img",112),a(),r(5,"div",143)(6,"div",144),l(7),a(),r(8,"div",21),l(9),a()()()(),r(10,"td",145)(11,"div",146),l(12),a()(),r(13,"td",145)(14,"div",146),l(15),a()(),y(16,ht,3,2,"td",147),r(17,"td",148)(18,"div",149),E(19,"div",150),a(),r(20,"div",151),l(21),a()(),r(22,"td",152)(23,"div",153)(24,"button",154),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityOwned-1))}),l(25," - "),a(),r(26,"input",155),g("input",function(t){let d=u(e).$implicit,p=_(5);return v(p.updatePartQuantity(d,+t.target.value))})("focus",function(t){return u(e),v(t.target.select())}),a(),r(27,"button",154),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityOwned+1))}),l(28," + "),a()()(),r(29,"td",156)(30,"div",153)(31,"button",157),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityNeeded))}),l(32," \u2713 "),a(),r(33,"button",158),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,0))}),l(34," \u2717 "),a()()()()}if(o&2){let e=n.$implicit,i=_(5);I("bg-green-50",e.quantityOwned>=e.quantityNeeded)("bg-yellow-50",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-50",e.quantityOwned===0),s(3),N(i.getListImageSizeClasses()+" mr-2 flex-shrink-0 cursor-pointer"),s(),c("src",e.imageUrl,F)("alt",e.part.name),s(3),M(e.part.name),s(2),M(e.part.part_num),s(3),M(e.color.name),s(3),M(e.elementId),s(),c("ngIf",i.isMissingPartsMode),s(3),A("width",e.quantityOwned/e.quantityNeeded*100,"%"),I("bg-green-500",e.quantityOwned>=e.quantityNeeded)("bg-yellow-500",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-500",e.quantityOwned===0),s(2),D("",e.quantityOwned,"/",e.quantityNeeded," "),s(3),c("disabled",e.quantityOwned<=0),s(2),c("value",e.quantityOwned)("min",0)("max",e.quantityNeeded),s(),c("disabled",e.quantityOwned>=e.quantityNeeded),s(4),c("disabled",e.quantityOwned>=e.quantityNeeded),s(2),c("disabled",e.quantityOwned===0)}}function bt(o,n){if(o&1&&(r(0,"div",129)(1,"div",130)(2,"table",131)(3,"thead",132)(4,"tr")(5,"th",133),l(6,"Part "),a(),r(7,"th",134),l(8," Color"),a(),r(9,"th",134),l(10," Element ID"),a(),y(11,xt,2,0,"th",135),r(12,"th",136),l(13," Progress"),a(),r(14,"th",137),l(15," Quantity"),a(),r(16,"th",138),l(17," Actions"),a()()(),r(18,"tbody",139),y(19,wt,35,32,"tr",140),a()()()()),o&2){let e=_(4);s(11),c("ngIf",e.isMissingPartsMode),s(8),c("ngForOf",e.filteredParts)("ngForTrackBy",e.trackByPartId)}}function St(o,n){if(o&1&&(r(0,"div"),y(1,yt,2,2,"div",105)(2,bt,20,3,"div",106),a()),o&2){let e=_(3);s(),c("ngIf",e.partsViewType==="tiles"),s(),c("ngIf",e.partsViewType==="list")}}function It(o,n){if(o&1){let e=C();r(0,"button",162),g("click",function(){u(e);let t=_(4);return t.searchTerm="",v(t.filterParts())}),l(1," Clear Search "),a()}}function Pt(o,n){if(o&1&&(r(0,"div",159)(1,"p",160),l(2,"No parts found matching your search criteria."),a(),y(3,It,2,0,"button",161),a()),o&2){let e=_(3);s(3),c("ngIf",e.searchTerm)}}function Ct(o,n){if(o&1){let e=C();r(0,"div")(1,"div",74)(2,"div",44)(3,"input",75),te("ngModelChange",function(t){u(e);let d=_(2);return ee(d.searchTerm,t)||(d.searchTerm=t),v(t)}),g("ngModelChange",function(){u(e);let t=_(2);return v(t.filterParts())}),a()(),r(4,"div",76)(5,"div",77)(6,"button",78),g("click",function(){u(e);let t=_(2);return v(t.togglePartsView())}),r(7,"span",52),l(8,"\u229E"),a(),l(9," Tiles "),a(),r(10,"button",78),g("click",function(){u(e);let t=_(2);return v(t.togglePartsView())}),r(11,"span",52),l(12,"\u2630"),a(),l(13," List "),a()(),r(14,"button",79),g("click",function(){u(e);let t=_(2);return v(t.toggleSortOptions())}),r(15,"span",52),l(16,"\u2699\uFE0F"),a(),l(17," Sort "),a(),r(18,"button",80),g("click",function(){u(e);let t=_(2);return v(t.markAllPartsOwned(!0))}),l(19," Mark All Complete "),a(),r(20,"button",81),g("click",function(){u(e);let t=_(2);return v(t.markAllPartsOwned(!1))}),l(21," Mark All Missing "),a()()(),y(22,ct,14,2,"div",82)(23,St,3,2,"div",83)(24,Pt,4,1,"ng-template",null,0,se),a()}if(o&2){let e=ae(25),i=_(2);s(3),X("ngModel",i.searchTerm),s(3),I("bg-blue-600",i.partsViewType==="tiles")("text-white",i.partsViewType==="tiles")("bg-gray-200",i.partsViewType!=="tiles")("text-gray-700",i.partsViewType!=="tiles"),s(4),I("bg-blue-600",i.partsViewType==="list")("text-white",i.partsViewType==="list")("bg-gray-200",i.partsViewType!=="list")("text-gray-700",i.partsViewType!=="list"),s(12),c("ngIf",i.showPartsSortOptions),s(),c("ngIf",i.filteredParts.length>0)("ngIfElse",e)}}function Ot(o,n){if(o&1&&(r(0,"option",101),l(1),a()),o&2){let e=n.$implicit,i=_().index,t=_(4);c("value",e.value)("disabled",t.isFieldDisabled("spare-parts",e.value,i)),s(),S(" ",e.label," ")}}function Mt(o,n){if(o&1){let e=C();r(0,"button",102),g("click",function(){u(e);let t=_().index,d=_(4);return v(d.removeSortOption("spare-parts",t))}),l(1," \u2715 "),a()}}function Et(o,n){if(o&1){let e=C();r(0,"div",93)(1,"span",94),l(2),a(),r(3,"select",95),te("ngModelChange",function(t){let d=u(e).$implicit;return ee(d.field,t)||(d.field=t),v(t)}),g("ngModelChange",function(t){let d=u(e),p=d.$implicit,m=d.index,f=_(4);return v(f.updateSortOption("spare-parts",m,t,p.direction))}),y(4,Ot,2,3,"option",96),a(),r(5,"select",97),g("change",function(t){let d=u(e),p=d.$implicit,m=d.index,f=_(4);return v(f.updateSortOption("spare-parts",m,p.field,t.target.value))}),r(6,"option",98),l(7,"Ascending"),a(),r(8,"option",99),l(9,"Descending"),a()(),y(10,Mt,2,0,"button",100),a()}if(o&2){let e=n.$implicit,i=n.index,t=_(4);s(2),S("",i+1,"."),s(),X("ngModel",e.field),s(),c("ngForOf",t.getAllFieldsForDropdown("spare-parts")),s(),c("value",e.direction),s(5),c("ngIf",t.sparePartsSortOptions.length>1)}}function Dt(o,n){if(o&1){let e=C();r(0,"div",103)(1,"button",104),g("click",function(){u(e);let t=_(4);return v(t.addSortOption("spare-parts"))}),l(2," + Add Sort Criteria "),a()()}}function Tt(o,n){if(o&1){let e=C();r(0,"div",84)(1,"div",85)(2,"h3",86),l(3,"Sort Spare Parts"),a(),r(4,"button",87),g("click",function(){u(e);let t=_(3);return v(t.resetToDefaultSort())}),l(5," Reset to Default "),a()(),r(6,"div",63),y(7,Et,11,5,"div",88)(8,Dt,3,0,"div",89),a(),r(9,"div",90)(10,"button",91),g("click",function(){u(e);let t=_(3);return v(t.closeSortOptions())}),l(11," Cancel "),a(),r(12,"button",92),g("click",function(){u(e);let t=_(3);return v(t.applySortChanges())}),l(13," Apply Sort "),a()()()}if(o&2){let e=_(3);s(7),c("ngForOf",e.sparePartsSortOptions),s(),c("ngIf",e.sparePartsSortOptions.length<3)}}function qt(o,n){if(o&1&&(r(0,"p",114),l(1),a()),o&2){let e=_().$implicit;s(),S("Element ID: ",e.elementId,"")}}function kt(o,n){o&1&&(r(0,"span"),l(1,"\u2713 Complete"),a())}function Vt(o,n){o&1&&(r(0,"span"),l(1,"\u26A0 Partial"),a())}function Nt(o,n){o&1&&(r(0,"span"),l(1,"\u2717 Missing"),a())}function $t(o,n){if(o&1){let e=C();r(0,"div",109)(1,"div",110)(2,"div")(3,"div",111),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.openImageOverlay(t.imageUrl,t.part.name))}),E(4,"img",112),a(),r(5,"div")(6,"h3",113),l(7),a(),r(8,"p",114),l(9),a(),r(10,"p",114),l(11),a(),y(12,qt,2,1,"p",115),r(13,"p",163),l(14,"Spare Part"),a()()(),r(15,"div",117)(16,"div",60)(17,"span"),l(18,"Progress"),a(),r(19,"span"),l(20),a()(),r(21,"div",65),E(22,"div",66),a()(),r(23,"div",118)(24,"label",119),l(25,"Owned:"),a(),r(26,"div",120)(27,"button",121),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityOwned-1))}),l(28," - "),a(),r(29,"input",122),g("input",function(t){let d=u(e).$implicit,p=_(5);return v(p.updatePartQuantity(d,+t.target.value))})("focus",function(t){return u(e),v(t.target.select())}),a(),r(30,"button",121),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityOwned+1))}),l(31," + "),a()(),r(32,"span",21),l(33),a()(),r(34,"div",123)(35,"button",124),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityNeeded))}),l(36," \u2713 "),a(),r(37,"button",125),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,0))}),l(38," \u2717 "),a()(),r(39,"div",126)(40,"span",127),y(41,kt,2,0,"span",39)(42,Vt,2,0,"span",39)(43,Nt,2,0,"span",39),a()()()()}if(o&2){let e=n.$implicit,i=_(5);I("bg-green-50",e.quantityOwned>=e.quantityNeeded)("bg-yellow-50",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-50",e.quantityOwned===0),s(2),N(i.shouldUseVerticalLayout()?"flex flex-col items-center mb-4":"flex items-start mb-4"),s(),N(i.getImageSizeClasses()+(i.shouldUseVerticalLayout()?" mb-3 flex-shrink-0 cursor-pointer":" mr-4 flex-shrink-0 cursor-pointer")),s(),c("src",e.imageUrl,F)("alt",e.part.name),s(),N(i.shouldUseVerticalLayout()?"flex-1 text-center":"flex-1"),s(2),M(e.part.name),s(2),S("Part #: ",e.part.part_num,""),s(2),S("Color: ",e.color.name,""),s(),c("ngIf",e.elementId),s(8),D("",e.quantityOwned," / ",e.quantityNeeded,""),s(2),A("width",e.quantityOwned/e.quantityNeeded*100,"%"),I("bg-green-500",e.quantityOwned>=e.quantityNeeded)("bg-yellow-500",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-500",e.quantityOwned===0),s(5),c("disabled",e.quantityOwned<=0),s(2),c("value",e.quantityOwned)("min",0)("max",e.quantityNeeded),s(),c("disabled",e.quantityOwned>=e.quantityNeeded),s(3),S("/ ",e.quantityNeeded,""),s(2),c("disabled",e.quantityOwned>=e.quantityNeeded),s(2),c("disabled",e.quantityOwned===0),s(3),I("text-green-600",e.quantityOwned>=e.quantityNeeded)("text-yellow-600",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("text-red-600",e.quantityOwned===0),s(),c("ngIf",e.quantityOwned>=e.quantityNeeded),s(),c("ngIf",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded),s(),c("ngIf",e.quantityOwned===0)}}function Ut(o,n){if(o&1&&(r(0,"div",107),y(1,$t,44,45,"div",108),a()),o&2){let e=_(4);s(),c("ngForOf",e.spareParts)("ngForTrackBy",e.trackBySparePartId)}}function Ft(o,n){if(o&1){let e=C();r(0,"tr")(1,"td",141)(2,"div",142)(3,"div",111),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.openImageOverlay(t.imageUrl,t.part.name))}),E(4,"img",112),a(),r(5,"div",143)(6,"div",144),l(7),a(),r(8,"div",21),l(9),a()()()(),r(10,"td",145)(11,"div",146),l(12),a()(),r(13,"td",145)(14,"div",146),l(15),a()(),r(16,"td",148)(17,"div",149),E(18,"div",150),a(),r(19,"div",151),l(20),a()(),r(21,"td",152)(22,"div",153)(23,"button",154),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityOwned-1))}),l(24," - "),a(),r(25,"input",155),g("input",function(t){let d=u(e).$implicit,p=_(5);return v(p.updatePartQuantity(d,+t.target.value))})("focus",function(t){return u(e),v(t.target.select())}),a(),r(26,"button",154),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityOwned+1))}),l(27," + "),a()()(),r(28,"td",156)(29,"div",153)(30,"button",157),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,t.quantityNeeded))}),l(31," \u2713 "),a(),r(32,"button",158),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.updatePartQuantity(t,0))}),l(33," \u2717 "),a()()()()}if(o&2){let e=n.$implicit,i=_(5);I("bg-green-50",e.quantityOwned>=e.quantityNeeded)("bg-yellow-50",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-50",e.quantityOwned===0),s(3),N(i.getListImageSizeClasses()+" mr-2 flex-shrink-0 cursor-pointer"),s(),c("src",e.imageUrl,F)("alt",e.part.name),s(3),M(e.part.name),s(2),M(e.part.part_num),s(3),M(e.color.name),s(3),M(e.elementId),s(3),A("width",e.quantityOwned/e.quantityNeeded*100,"%"),I("bg-green-500",e.quantityOwned>=e.quantityNeeded)("bg-yellow-500",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-500",e.quantityOwned===0),s(2),D("",e.quantityOwned,"/",e.quantityNeeded," "),s(3),c("disabled",e.quantityOwned<=0),s(2),c("value",e.quantityOwned)("min",0)("max",e.quantityNeeded),s(),c("disabled",e.quantityOwned>=e.quantityNeeded),s(4),c("disabled",e.quantityOwned>=e.quantityNeeded),s(2),c("disabled",e.quantityOwned===0)}}function At(o,n){if(o&1&&(r(0,"div",129)(1,"div",130)(2,"table",131)(3,"thead",132)(4,"tr")(5,"th",133),l(6,"Part "),a(),r(7,"th",134),l(8," Color"),a(),r(9,"th",134),l(10," Element ID"),a(),r(11,"th",136),l(12," Progress"),a(),r(13,"th",137),l(14," Quantity"),a(),r(15,"th",164),l(16," Actions"),a()()(),r(17,"tbody",139),y(18,Ft,34,31,"tr",140),a()()()()),o&2){let e=_(4);s(18),c("ngForOf",e.spareParts)("ngForTrackBy",e.trackBySparePartId)}}function Qt(o,n){if(o&1&&(r(0,"div"),y(1,Ut,2,2,"div",105)(2,At,19,2,"div",106),a()),o&2){let e=_(3);s(),c("ngIf",e.sparePartsViewType==="tiles"),s(),c("ngIf",e.sparePartsViewType==="list")}}function jt(o,n){o&1&&(r(0,"div",159)(1,"p",160),l(2,"No spare parts found for this set."),a()())}function Bt(o,n){if(o&1){let e=C();r(0,"div")(1,"div",74)(2,"div",44)(3,"h3",86),l(4),a()(),r(5,"div",76)(6,"div",77)(7,"button",78),g("click",function(){u(e);let t=_(2);return v(t.toggleSparePartsView())}),r(8,"span",52),l(9,"\u229E"),a(),l(10," Tiles "),a(),r(11,"button",78),g("click",function(){u(e);let t=_(2);return v(t.toggleSparePartsView())}),r(12,"span",52),l(13,"\u2630"),a(),l(14," List "),a()(),r(15,"button",79),g("click",function(){u(e);let t=_(2);return v(t.toggleSortOptions())}),r(16,"span",52),l(17,"\u2699\uFE0F"),a(),l(18," Sort "),a(),r(19,"button",80),g("click",function(){u(e);let t=_(2);return v(t.markAllSparePartsOwned(!0))}),l(20," Mark All Complete "),a(),r(21,"button",81),g("click",function(){u(e);let t=_(2);return v(t.markAllSparePartsOwned(!1))}),l(22," Mark All Missing "),a()()(),y(23,Tt,14,2,"div",82)(24,Qt,3,2,"div",83)(25,jt,3,0,"ng-template",null,1,se),a()}if(o&2){let e=ae(26),i=_(2);s(4),D("Spare Parts (",i.totalSparePartsOwned,"/",i.totalSparePartsNeeded,")"),s(3),I("bg-blue-600",i.sparePartsViewType==="tiles")("text-white",i.sparePartsViewType==="tiles")("bg-gray-200",i.sparePartsViewType!=="tiles")("text-gray-700",i.sparePartsViewType!=="tiles"),s(4),I("bg-blue-600",i.sparePartsViewType==="list")("text-white",i.sparePartsViewType==="list")("bg-gray-200",i.sparePartsViewType!=="list")("text-gray-700",i.sparePartsViewType!=="list"),s(12),c("ngIf",i.showSparePartsSortOptions),s(),c("ngIf",i.spareParts.length>0)("ngIfElse",e)}}function Lt(o,n){if(o&1&&(r(0,"option",101),l(1),a()),o&2){let e=n.$implicit,i=_().index,t=_(4);c("value",e.value)("disabled",t.isFieldDisabled("minifigs",e.value,i)),s(),S(" ",e.label," ")}}function zt(o,n){if(o&1){let e=C();r(0,"button",102),g("click",function(){u(e);let t=_().index,d=_(4);return v(d.removeSortOption("minifigs",t))}),l(1," \u2715 "),a()}}function Kt(o,n){if(o&1){let e=C();r(0,"div",93)(1,"span",94),l(2),a(),r(3,"select",95),te("ngModelChange",function(t){let d=u(e).$implicit;return ee(d.field,t)||(d.field=t),v(t)}),g("ngModelChange",function(t){let d=u(e),p=d.$implicit,m=d.index,f=_(4);return v(f.updateSortOption("minifigs",m,t,p.direction))}),y(4,Lt,2,3,"option",96),a(),r(5,"select",97),g("change",function(t){let d=u(e),p=d.$implicit,m=d.index,f=_(4);return v(f.updateSortOption("minifigs",m,p.field,t.target.value))}),r(6,"option",98),l(7,"Ascending"),a(),r(8,"option",99),l(9,"Descending"),a()(),y(10,zt,2,0,"button",100),a()}if(o&2){let e=n.$implicit,i=n.index,t=_(4);s(2),S("",i+1,"."),s(),X("ngModel",e.field),s(),c("ngForOf",t.getAllFieldsForDropdown("minifigs")),s(),c("value",e.direction),s(5),c("ngIf",t.minifigsSortOptions.length>1)}}function Rt(o,n){if(o&1){let e=C();r(0,"div",103)(1,"button",104),g("click",function(){u(e);let t=_(4);return v(t.addSortOption("minifigs"))}),l(2," + Add Sort Criteria "),a()()}}function Ht(o,n){if(o&1){let e=C();r(0,"div",84)(1,"div",85)(2,"h3",86),l(3,"Sort Minifigures"),a(),r(4,"button",87),g("click",function(){u(e);let t=_(3);return v(t.resetToDefaultSort())}),l(5," Reset to Default "),a()(),r(6,"div",63),y(7,Kt,11,5,"div",88)(8,Rt,3,0,"div",89),a(),r(9,"div",90)(10,"button",91),g("click",function(){u(e);let t=_(3);return v(t.closeSortOptions())}),l(11," Cancel "),a(),r(12,"button",92),g("click",function(){u(e);let t=_(3);return v(t.applySortChanges())}),l(13," Apply Sort "),a()()()}if(o&2){let e=_(3);s(7),c("ngForOf",e.minifigsSortOptions),s(),c("ngIf",e.minifigsSortOptions.length<3)}}function Wt(o,n){if(o&1&&(r(0,"p",128),l(1),a()),o&2){let e=_().$implicit;s(),D("From: ",e.setName," (",e.setNum,")")}}function Gt(o,n){o&1&&(r(0,"span"),l(1,"\u2713 Complete"),a())}function Yt(o,n){if(o&1&&(r(0,"span"),l(1),W(2,"number"),a()),o&2){let e=_().$implicit,i=_(5);s(),S("\u26A0 Partial (",G(2,1,i.getMinifigPartsProgress(e.minifig.fig_num).percentage,"1.0-0"),"%)")}}function Jt(o,n){o&1&&(r(0,"span"),l(1,"\u2717 Missing"),a())}function Zt(o,n){o&1&&(r(0,"span",52),l(1,"\u25B6"),a())}function Xt(o,n){o&1&&(r(0,"span",52),l(1,"\u25BC"),a())}function ei(o,n){o&1&&(r(0,"span"),l(1,"\u2713"),a())}function ti(o,n){o&1&&(r(0,"span"),l(1,"\u26A0"),a())}function ii(o,n){o&1&&(r(0,"span"),l(1,"\u2717"),a())}function ni(o,n){if(o&1){let e=C();r(0,"div",174)(1,"div",175)(2,"div",176)(3,"div",177),g("click",function(){let t=u(e).$implicit,d=_(7);return v(d.openImageOverlay(t.imageUrl,t.part.name))}),E(4,"img",112),a(),r(5,"div",178)(6,"h5",179),l(7),a(),r(8,"p",180),l(9),a(),r(10,"p",180),l(11),a()()(),r(12,"div",181)(13,"div",182)(14,"span"),l(15,"Progress"),a(),r(16,"span"),l(17),a()(),r(18,"div",183),E(19,"div",150),a()(),r(20,"div",153)(21,"button",184),g("click",function(){let t=u(e).$implicit,d=_(2).$implicit,p=_(5);return v(p.updateMinifigPartQuantity((p.userInventory==null?null:p.userInventory.set_num)||"",d.minifig.fig_num,t,t.quantityOwned-1))}),l(22," - "),a(),r(23,"input",185),g("input",function(t){let d=u(e).$implicit,p=_(2).$implicit,m=_(5);return v(m.updateMinifigPartQuantity((m.userInventory==null?null:m.userInventory.set_num)||"",p.minifig.fig_num,d,+t.target.value))})("focus",function(t){return u(e),v(t.target.select())}),a(),r(24,"button",184),g("click",function(){let t=u(e).$implicit,d=_(2).$implicit,p=_(5);return v(p.updateMinifigPartQuantity((p.userInventory==null?null:p.userInventory.set_num)||"",d.minifig.fig_num,t,t.quantityOwned+1))}),l(25," + "),a()(),r(26,"div",186)(27,"span",187),y(28,ei,2,0,"span",39)(29,ti,2,0,"span",39)(30,ii,2,0,"span",39),a()(),r(31,"div",188)(32,"button",189),g("click",function(){let t=u(e).$implicit,d=_(2).$implicit,p=_(5);return v(p.updateMinifigPartQuantity((p.userInventory==null?null:p.userInventory.set_num)||"",d.minifig.fig_num,t,t.quantityNeeded))}),l(33," \u2713 "),a(),r(34,"button",190),g("click",function(){let t=u(e).$implicit,d=_(2).$implicit,p=_(5);return v(p.updateMinifigPartQuantity((p.userInventory==null?null:p.userInventory.set_num)||"",d.minifig.fig_num,t,0))}),l(35," \u2717 "),a()()()()}if(o&2){let e=n.$implicit;I("bg-green-50",e.quantityOwned>=e.quantityNeeded)("bg-yellow-50",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-50",e.quantityOwned===0),s(4),c("src",e.imageUrl,F)("alt",e.part.name),s(3),M(e.part.name),s(2),M(e.part.part_num),s(2),M(e.color.name),s(6),D("",e.quantityOwned," / ",e.quantityNeeded,""),s(2),A("width",e.quantityOwned/e.quantityNeeded*100,"%"),I("bg-green-500",e.quantityOwned>=e.quantityNeeded)("bg-yellow-500",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-500",e.quantityOwned===0),s(2),c("disabled",e.quantityOwned<=0),s(2),c("value",e.quantityOwned)("min",0)("max",e.quantityNeeded),s(),c("disabled",e.quantityOwned>=e.quantityNeeded),s(3),I("text-green-600",e.quantityOwned>=e.quantityNeeded)("text-yellow-600",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("text-red-600",e.quantityOwned===0),s(),c("ngIf",e.quantityOwned>=e.quantityNeeded),s(),c("ngIf",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded),s(),c("ngIf",e.quantityOwned===0),s(2),c("disabled",e.quantityOwned>=e.quantityNeeded),s(2),c("disabled",e.quantityOwned===0)}}function ri(o,n){if(o&1&&(r(0,"div",169)(1,"div",170)(2,"h4",171),l(3,"Minifigure Parts"),a(),r(4,"div",172),y(5,ni,36,37,"div",173),a()()()),o&2){let e=_().$implicit,i=_(5);s(5),c("ngForOf",i.getMinifigParts(e.minifig.fig_num))}}function ai(o,n){if(o&1){let e=C();r(0,"div",109)(1,"div",110)(2,"div")(3,"div",111),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.openImageOverlay(t.imageUrl,t.minifig.name))}),E(4,"img",112),a(),r(5,"div")(6,"h3",113),l(7),a(),r(8,"p",114),l(9),a(),r(10,"p",114),l(11),a(),y(12,Wt,2,2,"p",116),a()(),r(13,"div",117)(14,"div",60)(15,"span"),l(16,"Parts Progress"),a(),r(17,"span"),l(18),a()(),r(19,"div",65),E(20,"div",66),a()(),r(21,"div",126)(22,"span",127),y(23,Gt,2,0,"span",39)(24,Yt,3,4,"span",39)(25,Jt,2,0,"span",39),a()(),r(26,"div",165)(27,"button",166),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.toggleMinifigParts(t.minifig.fig_num))}),y(28,Zt,2,0,"span",167)(29,Xt,2,0,"span",167),l(30),a()()(),y(31,ri,6,1,"div",168),a()}if(o&2){let e=n.$implicit,i=_(5);I("bg-green-50",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>=100)("bg-yellow-50",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>0&&i.getMinifigPartsProgress(e.minifig.fig_num).percentage<100)("bg-red-50",i.getMinifigPartsProgress(e.minifig.fig_num).percentage===0),s(2),N(i.shouldUseVerticalLayout()?"flex flex-col items-center mb-4":"flex items-start mb-4"),s(),N(i.getImageSizeClasses()+(i.shouldUseVerticalLayout()?" mb-3 flex-shrink-0 cursor-pointer":" mr-4 flex-shrink-0 cursor-pointer")),s(),c("src",e.imageUrl,F)("alt",e.minifig.name),s(),N(i.shouldUseVerticalLayout()?"flex-1 text-center":"flex-1"),s(2),M(e.minifig.name),s(2),S("Fig #: ",e.minifig.fig_num,""),s(2),S("Parts: ",e.minifig.num_parts,""),s(),c("ngIf",i.isMissingPartsMode&&e.setName),s(6),D("",i.getMinifigPartsProgress(e.minifig.fig_num).owned," / ",i.getMinifigPartsProgress(e.minifig.fig_num).total,""),s(2),A("width",i.getMinifigPartsProgress(e.minifig.fig_num).percentage,"%"),I("bg-green-500",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>=100)("bg-yellow-500",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>0&&i.getMinifigPartsProgress(e.minifig.fig_num).percentage<100)("bg-red-500",i.getMinifigPartsProgress(e.minifig.fig_num).percentage===0),s(2),I("text-green-600",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>=100)("text-yellow-600",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>0&&i.getMinifigPartsProgress(e.minifig.fig_num).percentage<100)("text-red-600",i.getMinifigPartsProgress(e.minifig.fig_num).percentage===0),s(),c("ngIf",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>=100),s(),c("ngIf",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>0&&i.getMinifigPartsProgress(e.minifig.fig_num).percentage<100),s(),c("ngIf",i.getMinifigPartsProgress(e.minifig.fig_num).percentage===0),s(3),c("ngIf",!i.isMinifigPartsExpanded(e.minifig.fig_num)),s(),c("ngIf",i.isMinifigPartsExpanded(e.minifig.fig_num)),s(),S(" ",i.isMinifigPartsExpanded(e.minifig.fig_num)?"Hide Parts":"Show Parts"," "),s(),c("ngIf",i.isMinifigPartsExpanded(e.minifig.fig_num))}}function oi(o,n){if(o&1&&(r(0,"div",107),y(1,ai,32,41,"div",108),a()),o&2){let e=_(4);s(),c("ngForOf",e.minifigs)("ngForTrackBy",e.trackByMinifigId)}}function si(o,n){o&1&&(r(0,"th",136),l(1,"Set"),a())}function li(o,n){if(o&1&&(r(0,"td",148)(1,"div",146),l(2),a()()),o&2){let e=_().$implicit;s(2),D("",e.setName," (",e.setNum,")")}}function di(o,n){o&1&&(r(0,"span",52),l(1,"\u25B6"),a())}function _i(o,n){o&1&&(r(0,"span",52),l(1,"\u25BC"),a())}function ci(o,n){if(o&1){let e=C();r(0,"tr")(1,"td",203)(2,"div",142)(3,"div",204),g("click",function(){let t=u(e).$implicit,d=_(7);return v(d.openImageOverlay(t.imageUrl,t.part.name))}),E(4,"img",112),a(),r(5,"div",143)(6,"div",205),l(7),a(),r(8,"div",206),l(9),a()()()(),r(10,"td",207)(11,"div",208),l(12),a()(),r(13,"td",207)(14,"div",209),E(15,"div",210),a(),r(16,"div",211),l(17),a()(),r(18,"td",207)(19,"div",153)(20,"button",212),g("click",function(){let t=u(e).$implicit,d=_(2).$implicit,p=_(5);return v(p.updateMinifigPartQuantity((p.userInventory==null?null:p.userInventory.set_num)||"",d.minifig.fig_num,t,t.quantityOwned-1))}),l(21," - "),a(),r(22,"input",213),g("input",function(t){let d=u(e).$implicit,p=_(2).$implicit,m=_(5);return v(m.updateMinifigPartQuantity((m.userInventory==null?null:m.userInventory.set_num)||"",p.minifig.fig_num,d,+t.target.value))})("focus",function(t){return u(e),v(t.target.select())}),a(),r(23,"button",212),g("click",function(){let t=u(e).$implicit,d=_(2).$implicit,p=_(5);return v(p.updateMinifigPartQuantity((p.userInventory==null?null:p.userInventory.set_num)||"",d.minifig.fig_num,t,t.quantityOwned+1))}),l(24," + "),a()()(),r(25,"td",214)(26,"div",153)(27,"button",215),g("click",function(){let t=u(e).$implicit,d=_(2).$implicit,p=_(5);return v(p.updateMinifigPartQuantity((p.userInventory==null?null:p.userInventory.set_num)||"",d.minifig.fig_num,t,t.quantityNeeded))}),l(28," \u2713 "),a(),r(29,"button",216),g("click",function(){let t=u(e).$implicit,d=_(2).$implicit,p=_(5);return v(p.updateMinifigPartQuantity((p.userInventory==null?null:p.userInventory.set_num)||"",d.minifig.fig_num,t,0))}),l(30," \u2717 "),a()()()()}if(o&2){let e=n.$implicit;I("bg-green-50",e.quantityOwned>=e.quantityNeeded)("bg-yellow-50",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-50",e.quantityOwned===0),s(4),c("src",e.imageUrl,F)("alt",e.part.name),s(3),M(e.part.name),s(2),M(e.part.part_num),s(3),M(e.color.name),s(3),A("width",e.quantityOwned/e.quantityNeeded*100,"%"),I("bg-green-500",e.quantityOwned>=e.quantityNeeded)("bg-yellow-500",e.quantityOwned>0&&e.quantityOwned<e.quantityNeeded)("bg-red-500",e.quantityOwned===0),s(2),D("",e.quantityOwned,"/",e.quantityNeeded,""),s(3),c("disabled",e.quantityOwned<=0),s(2),c("value",e.quantityOwned)("min",0)("max",e.quantityNeeded),s(),c("disabled",e.quantityOwned>=e.quantityNeeded),s(4),c("disabled",e.quantityOwned>=e.quantityNeeded),s(2),c("disabled",e.quantityOwned===0)}}function pi(o,n){if(o&1&&(r(0,"tr",132)(1,"td",196)(2,"div",197)(3,"h4",171),l(4,"Minifigure Parts"),a(),r(5,"div",198)(6,"div",130)(7,"table",199)(8,"thead",200)(9,"tr")(10,"th",201),l(11,"Part"),a(),r(12,"th",201),l(13,"Color"),a(),r(14,"th",201),l(15,"Progress"),a(),r(16,"th",201),l(17,"Quantity"),a(),r(18,"th",201),l(19,"Actions"),a()()(),r(20,"tbody",139),y(21,ci,31,28,"tr",202),a()()()()()()()),o&2){let e=_().$implicit,i=_(5);s(),pe("colspan",i.isMissingPartsMode?7:6),s(20),c("ngForOf",i.getMinifigParts(e.minifig.fig_num))}}function mi(o,n){if(o&1){let e=C();me(0),r(1,"tr")(2,"td",141)(3,"div",142)(4,"div",111),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.openImageOverlay(t.imageUrl,t.minifig.name))}),E(5,"img",112),a(),r(6,"div",143)(7,"div",144),l(8),a(),r(9,"div",21),l(10),a()()()(),r(11,"td",192)(12,"div",193),l(13),a()(),y(14,li,3,2,"td",147),r(15,"td",148)(16,"div",149),E(17,"div",150),a(),r(18,"div",151),l(19),a()(),r(20,"td",156)(21,"button",194),g("click",function(){let t=u(e).$implicit,d=_(5);return v(d.toggleMinifigParts(t.minifig.fig_num))}),y(22,di,2,0,"span",167)(23,_i,2,0,"span",167),l(24),a()()(),y(25,pi,22,2,"tr",195),ue()}if(o&2){let e=n.$implicit,i=_(5);s(),I("bg-green-50",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>=100)("bg-yellow-50",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>0&&i.getMinifigPartsProgress(e.minifig.fig_num).percentage<100)("bg-red-50",i.getMinifigPartsProgress(e.minifig.fig_num).percentage===0),s(3),N(i.getListImageSizeClasses()+" mr-2 flex-shrink-0 cursor-pointer"),s(),c("src",e.imageUrl,F)("alt",e.minifig.name),s(3),M(e.minifig.name),s(2),M(e.minifig.fig_num),s(3),M(e.minifig.num_parts),s(),c("ngIf",i.isMissingPartsMode),s(3),A("width",i.getMinifigPartsProgress(e.minifig.fig_num).percentage,"%"),I("bg-green-500",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>=100)("bg-yellow-500",i.getMinifigPartsProgress(e.minifig.fig_num).percentage>0&&i.getMinifigPartsProgress(e.minifig.fig_num).percentage<100)("bg-red-500",i.getMinifigPartsProgress(e.minifig.fig_num).percentage===0),s(2),D("",i.getMinifigPartsProgress(e.minifig.fig_num).owned,"/",i.getMinifigPartsProgress(e.minifig.fig_num).total,""),s(3),c("ngIf",!i.isMinifigPartsExpanded(e.minifig.fig_num)),s(),c("ngIf",i.isMinifigPartsExpanded(e.minifig.fig_num)),s(),S(" ",i.isMinifigPartsExpanded(e.minifig.fig_num)?"Hide":"Show"," "),s(),c("ngIf",i.isMinifigPartsExpanded(e.minifig.fig_num))}}function ui(o,n){if(o&1&&(r(0,"div",129)(1,"div",130)(2,"table",131)(3,"thead",132)(4,"tr")(5,"th",133),l(6," Minifigure"),a(),r(7,"th",138),l(8," Parts"),a(),y(9,si,2,0,"th",135),r(10,"th",136),l(11," Parts Progress"),a(),r(12,"th",138),l(13," Show Parts"),a()()(),r(14,"tbody",139),y(15,mi,26,28,"ng-container",191),a()()()()),o&2){let e=_(4);s(9),c("ngIf",e.isMissingPartsMode),s(6),c("ngForOf",e.minifigs)("ngForTrackBy",e.trackByMinifigId)}}function vi(o,n){if(o&1&&(r(0,"div"),y(1,oi,2,2,"div",105)(2,ui,16,3,"div",106),a()),o&2){let e=_(3);s(),c("ngIf",e.minifigsViewType==="tiles"),s(),c("ngIf",e.minifigsViewType==="list")}}function gi(o,n){o&1&&(r(0,"div",159)(1,"p",160),l(2,"No minifigures found for this set."),a()())}function fi(o,n){if(o&1){let e=C();r(0,"div")(1,"div",74)(2,"div",44)(3,"h3",86),l(4),a()(),r(5,"div",76)(6,"div",77)(7,"button",78),g("click",function(){u(e);let t=_(2);return v(t.toggleMinifigsView())}),r(8,"span",52),l(9,"\u229E"),a(),l(10," Tiles "),a(),r(11,"button",78),g("click",function(){u(e);let t=_(2);return v(t.toggleMinifigsView())}),r(12,"span",52),l(13,"\u2630"),a(),l(14," List "),a()(),r(15,"button",79),g("click",function(){u(e);let t=_(2);return v(t.toggleSortOptions())}),r(16,"span",52),l(17,"\u2699\uFE0F"),a(),l(18," Sort "),a(),r(19,"button",80),g("click",function(){u(e);let t=_(2);return v(t.markAllMinifigsOwned(!0))}),l(20," Mark All Complete "),a(),r(21,"button",81),g("click",function(){u(e);let t=_(2);return v(t.markAllMinifigsOwned(!1))}),l(22," Mark All Missing "),a()()(),y(23,Ht,14,2,"div",82)(24,vi,3,2,"div",83)(25,gi,3,0,"ng-template",null,2,se),a()}if(o&2){let e=ae(26),i=_(2);s(4),D("Minifigures (",i.getTotalMinifigPartsProgress().owned,"/",i.getTotalMinifigPartsProgress().total,")"),s(3),I("bg-blue-600",i.minifigsViewType==="tiles")("text-white",i.minifigsViewType==="tiles")("bg-gray-200",i.minifigsViewType!=="tiles")("text-gray-700",i.minifigsViewType!=="tiles"),s(4),I("bg-blue-600",i.minifigsViewType==="list")("text-white",i.minifigsViewType==="list")("bg-gray-200",i.minifigsViewType!=="list")("text-gray-700",i.minifigsViewType!=="list"),s(12),c("ngIf",i.showMinifigsSortOptions),s(),c("ngIf",i.minifigs.length>0)("ngIfElse",e)}}function yi(o,n){if(o&1){let e=C();r(0,"div",32)(1,"div",33),y(2,Ye,28,15,"div",34)(3,Je,12,2,"div",35),r(4,"div",36)(5,"nav",37)(6,"button",38),g("click",function(){u(e);let t=_();return v(t.switchToTab("parts"))}),y(7,Ze,2,2,"span",39)(8,Xe,2,1,"span",39)(9,et,2,1,"span",40),a(),r(10,"button",38),g("click",function(){u(e);let t=_();return v(t.switchToTab("spare-parts"))}),y(11,tt,2,2,"span",39)(12,it,2,1,"span",39)(13,nt,2,1,"span",40),a(),r(14,"button",38),g("click",function(){u(e);let t=_();return v(t.switchToTab("minifigs"))}),y(15,rt,2,2,"span",39)(16,at,2,1,"span",39)(17,ot,2,1,"span",40),a()()(),y(18,Ct,26,20,"div",39)(19,Bt,27,21,"div",39)(20,fi,27,21,"div",39),a()()}if(o&2){let e=_();s(2),c("ngIf",!e.isMissingPartsMode),s(),c("ngIf",e.isMissingPartsMode),s(3),I("text-blue-600",e.activeTab==="parts")("border-blue-600",e.activeTab==="parts")("border-transparent",e.activeTab!=="parts"),s(),c("ngIf",!e.isMissingPartsMode),s(),c("ngIf",e.isMissingPartsMode),s(),c("ngIf",e.missingPartsCount>0&&!e.isMissingPartsMode),s(),I("text-blue-600",e.activeTab==="spare-parts")("border-blue-600",e.activeTab==="spare-parts")("border-transparent",e.activeTab!=="spare-parts"),s(),c("ngIf",!e.isMissingPartsMode),s(),c("ngIf",e.isMissingPartsMode),s(),c("ngIf",e.missingSparePartsCount>0&&!e.isMissingPartsMode),s(),I("text-blue-600",e.activeTab==="minifigs")("border-blue-600",e.activeTab==="minifigs")("border-transparent",e.activeTab!=="minifigs"),s(),c("ngIf",!e.isMissingPartsMode),s(),c("ngIf",e.isMissingPartsMode),s(),c("ngIf",e.getTotalMinifigPartsProgress().missing>0&&!e.isMissingPartsMode),s(),c("ngIf",e.activeTab==="parts"),s(),c("ngIf",e.activeTab==="spare-parts"),s(),c("ngIf",e.activeTab==="minifigs")}}function xi(o,n){if(o&1){let e=C();r(0,"div",217),g("click",function(t){u(e);let d=_();return v(d.onOverlayClick(t))}),r(1,"div",218)(2,"button",219),g("click",function(){u(e);let t=_();return v(t.closeImageOverlay())}),l(3," \xD7 "),a(),E(4,"img",220),r(5,"div",221)(6,"p",18),l(7," Image \xA9 "),r(8,"a",222),l(9,"Rebrickable"),a()()()()()}if(o&2){let e=_();s(4),c("src",e.getLargeImageUrl(e.overlayImageUrl),F)("alt",e.overlayImageAlt)}}function hi(o,n){if(o&1){let e=C();r(0,"button",223),g("click",function(){u(e);let t=_();return v(t.performUndo())}),r(1,"span",11),l(2,"\u27F2"),a()()}if(o&2){let e=_();c("disabled",!e.canUndo)("title",e.canUndo?"Undo last action (Cmd/Ctrl+Z) - "+((e.userInventory==null||e.userInventory.undoHistory==null?null:e.userInventory.undoHistory.length)||0)+" actions available":"No actions to undo")}}function wi(o,n){if(o&1&&(r(0,"span",224),l(1),a()),o&2){let e=_();s(),S(" ",e.userInventory==null||e.userInventory.undoHistory==null?null:e.userInventory.undoHistory.length," ")}}function bi(o,n){if(o&1&&(r(0,"div",225)(1,"div",118)(2,"span",11),l(3,"\u2713"),a(),r(4,"span"),l(5),a()()()),o&2){let e=_();s(5),M(e.undoNotificationMessage)}}var qe=class o{constructor(n,e,i,t){this.route=n;this.dataService=e;this.storageService=i;this.changeDetectorRef=t;this.initializeDefaultSorting()}userInventory=null;inventory=null;set=null;parts=[];minifigs=[];spareParts=[];loading=!0;searchTerm="";filteredParts=[];activeTab="parts";missingPartsCount=0;missingMinifigsCount=0;missingSparePartsCount=0;isMissingPartsMode=!1;userInventories=[];theme=null;uniqueColorsCount=0;totalPartsNeeded=0;totalPartsOwned=0;totalMinifigsNeeded=0;totalMinifigsOwned=0;totalSparePartsNeeded=0;totalSparePartsOwned=0;overallProgress=0;showSortOptions=!1;partsSortOptions=[];minifigsSortOptions=[];sparePartsSortOptions=[];showPartsSortOptions=!1;showSparePartsSortOptions=!1;showMinifigsSortOptions=!1;partsViewType="tiles";minifigsViewType="tiles";sparePartsViewType="tiles";showImageOverlay=!1;overlayImageUrl="";overlayImageAlt="";maxUndoHistory=100;canUndo=!1;showUndoNotification=!1;undoNotificationMessage="";partSortFields=[{value:"completion",label:"Completion Status"},{value:"color",label:"Color"},{value:"partNumber",label:"Part Number"},{value:"partName",label:"Part Name"},{value:"elementId",label:"Element ID"},{value:"quantityMissing",label:"Quantity Missing"},{value:"quantityNeeded",label:"Quantity Needed"}];minifigSortFields=[{value:"completion",label:"Completion Status"},{value:"figNumber",label:"Figure Number"},{value:"figName",label:"Figure Name"},{value:"quantityMissing",label:"Quantity Missing"},{value:"quantityNeeded",label:"Quantity Needed"}];globalSettings={imagePreviewSize:"1x",includeSparePartsInProgress:!0};collapsedMinifigParts=[];minifigPartsCache=new Map;_totalMinifigPartsProgress={owned:0,total:0,missing:0,percentage:0};getPartStorageKey(n,e,i){let t=`${n}_${e}`;return i?`spare_${t}`:t}getMinifigPartStorageKey(n,e,i,t){return`${n}_${e}_${i}_${t}`}toggleMinifigParts(n){let e=this.collapsedMinifigParts.indexOf(n);e>-1?this.collapsedMinifigParts.splice(e,1):this.collapsedMinifigParts.push(n),this.saveMinifigPartsState()}isMinifigPartsExpanded(n){return!this.collapsedMinifigParts.includes(n)}saveMinifigPartsState(){if(this.isMissingPartsMode||!this.userInventory)return;let n=Q(k({},this.userInventory),{collapsedMinifigParts:[...this.collapsedMinifigParts],lastUpdated:Date.now()});this.userInventory=n,this.storageService.updateUserInventory(n)}loadMinifigPartsState(){this.isMissingPartsMode?this.collapsedMinifigParts=[]:this.userInventory?.collapsedMinifigParts?this.collapsedMinifigParts=[...this.userInventory.collapsedMinifigParts]:this.collapsedMinifigParts=[]}getMinifigParts(n){if(this.minifigPartsCache.has(n)){let t=this.minifigPartsCache.get(n);return this.sortMinifigParts([...t])}let i=this.dataService.getCurrentInventories().find(t=>t.set_num===n);return i?(this.loadMinifigPartsAsync(n,i.id),[]):(this.minifigPartsCache.set(n,[]),[])}loadMinifigPartsAsync(n,e){let i=this.dataService.getCurrentParts(),t=this.dataService.getCurrentColors(),d=this.dataService.getCurrentElements(),p=new Map(i.map(w=>[w.part_num,w])),m=new Map(t.map(w=>[w.id,w])),f=new Map(d.map(w=>[`${w.part_num}_${w.color_id}`,w.element_id]));this.dataService.getInventoryPartsFromCache(e).subscribe(w=>{let x=[];for(let P of w){let T=p.get(P.part_num),q=m.get(P.color_id);if(T&&q){let V=f.get(`${P.part_num}_${P.color_id}`),$=this.getMinifigPartStorageKey(this.userInventory?.set_num||"",n,P.part_num,P.color_id),U=this.userInventory?.minifigPartsOwned?.[$]||0,j={inventoryPart:P,part:T,color:q,imageUrl:P.img_url,quantityNeeded:P.quantity,quantityOwned:U,elementId:V};x.push(j)}}let h=this.sortMinifigParts(x);this.minifigPartsCache.set(n,h),this.updateTotalMinifigPartsProgress()})}sortMinifigParts(n){try{return n.sort((e,i)=>{let t=e.quantityOwned>=e.quantityNeeded,d=i.quantityOwned>=i.quantityNeeded;if(t!==d)return t?1:-1;let p=String(e.color?.name||""),m=String(i.color?.name||""),f=p.localeCompare(m);if(f!==0)return f;let w=String(e.part?.part_num||""),x=String(i.part?.part_num||"");return w.localeCompare(x)})}catch(e){return console.error("Error sorting minifigure parts:",e),n}}getMinifigPartsProgress(n){let e=this.getMinifigParts(n),i=e.reduce((p,m)=>p+m.quantityOwned,0),t=e.reduce((p,m)=>p+m.quantityNeeded,0),d=t>0?Math.round(i/t*100):0;return{owned:i,total:t,percentage:d}}getTotalMinifigPartsProgress(){return this._totalMinifigPartsProgress}updateTotalMinifigPartsProgress(){let n=0,e=0;this.minifigs.forEach(d=>{let p=d.minifig.fig_num,m=this.minifigPartsCache.get(p);if(m&&m.length>0){let f=m.reduce((x,h)=>x+h.quantityOwned,0),w=m.reduce((x,h)=>x+h.quantityNeeded,0);n+=f,e+=w}});let i=e-n,t=e>0?Math.round(n/e*100):0;this._totalMinifigPartsProgress={owned:n,total:e,missing:i,percentage:t}}updateCounts(){this.missingPartsCount=this.parts.reduce((i,t)=>i+Math.max(0,t.quantityNeeded-t.quantityOwned),0),this.missingMinifigsCount=this.minifigs.reduce((i,t)=>i+Math.max(0,t.quantityNeeded-t.quantityOwned),0),this.missingSparePartsCount=this.spareParts.reduce((i,t)=>i+Math.max(0,t.quantityNeeded-t.quantityOwned),0),this.totalPartsNeeded=this.parts.reduce((i,t)=>i+t.quantityNeeded,0),this.totalPartsOwned=this.parts.reduce((i,t)=>i+t.quantityOwned,0),this.totalMinifigsNeeded=this.minifigs.reduce((i,t)=>i+t.quantityNeeded,0),this.totalMinifigsOwned=this.minifigs.reduce((i,t)=>i+t.quantityOwned,0),this.totalSparePartsNeeded=this.spareParts.reduce((i,t)=>i+t.quantityNeeded,0),this.totalSparePartsOwned=this.spareParts.reduce((i,t)=>i+t.quantityOwned,0);let n,e;this.globalSettings.includeSparePartsInProgress?(n=this.totalPartsNeeded+this.totalMinifigsNeeded+this.totalSparePartsNeeded,e=this.totalPartsOwned+this.totalMinifigsOwned+this.totalSparePartsOwned):(n=this.totalPartsNeeded+this.totalMinifigsNeeded,e=this.totalPartsOwned+this.totalMinifigsOwned),this.overallProgress=n>0?e/n*100:0,this.updateTotalMinifigPartsProgress()}filterParts(){if(!this.searchTerm){this.filteredParts=[...this.parts];return}let n=this.searchTerm.toLowerCase(),e=this.parts.filter(i=>i.part.name.toLowerCase().includes(n)||i.part.part_num.toLowerCase().includes(n)||i.color.name.toLowerCase().includes(n));this.filteredParts=this.sortParts(e)}updatePartQuantity(n,e){if(!this.userInventory)return;let i=this.getPartStorageKey(n.inventoryPart.part_num,n.inventoryPart.color_id,n.inventoryPart.is_spare),t=n.quantityOwned,d=Math.max(0,Math.min(e,n.quantityNeeded));if(d===t)return;n.quantityOwned=d;let p={};for(let[w,x]of Object.entries(this.userInventory.partsOwned))p[w]=typeof x=="number"?x:x?1:0;p[i]=d;let m=Q(k({},this.userInventory),{partsOwned:p,lastUpdated:Date.now()});this.userInventory=m,this.storageService.updateUserInventory(m),this.updateCounts();let f={type:"part",key:i,previousQuantity:t,newQuantity:d,timestamp:Date.now(),description:`Changed ${n.part.name} quantity from ${t} to ${d}`};this.addUndoAction(f)}updateMinifigQuantity(n,e){if(!this.userInventory)return;let i=n.inventoryMinifig.fig_num,t=n.quantityOwned,d=Math.max(0,Math.min(e,n.quantityNeeded));if(d===t)return;n.quantityOwned=d;let p={};for(let[w,x]of Object.entries(this.userInventory.minifigsOwned))p[w]=typeof x=="number"?x:x?1:0;p[n.inventoryMinifig.fig_num]=d;let m=Q(k({},this.userInventory),{minifigsOwned:p,lastUpdated:Date.now()});this.userInventory=m,this.storageService.updateUserInventory(m),this.updateCounts();let f={type:"minifig",key:i,previousQuantity:t,newQuantity:d,timestamp:Date.now(),description:`Changed ${n.minifig.name} quantity from ${t} to ${d}`};this.addUndoAction(f)}updateMinifigPartQuantity(n,e,i,t){if(!this.userInventory)return;let d=this.getMinifigPartStorageKey(n,e,i.inventoryPart.part_num,i.inventoryPart.color_id),p=i.quantityOwned,m=Math.max(0,Math.min(t,i.quantityNeeded));if(m===p)return;i.quantityOwned=m,this.userInventory.minifigPartsOwned||(this.userInventory.minifigPartsOwned={}),this.userInventory.minifigPartsOwned[d]=m;let f=this.minifigPartsCache.get(e);if(f){let h=f.find(P=>P.inventoryPart.part_num===i.inventoryPart.part_num&&P.inventoryPart.color_id===i.inventoryPart.color_id);h&&(h.quantityOwned=m)}let w=Q(k({},this.userInventory),{lastUpdated:Date.now()});this.userInventory=w,this.storageService.updateUserInventory(w),this.updateCounts();let x={type:"minifig-part",key:d,previousQuantity:p,newQuantity:m,timestamp:Date.now(),description:`Changed ${i.part.name} (${e}) quantity from ${p} to ${m}`};this.addUndoAction(x)}getPartImageUrl(n,e,i){return`https://cdn.rebrickable.com/media/thumbs/parts/elements/${i}.jpg/800x800p.jpg?`+Date.now()%1e6}getMinifigImageUrl(n){return`assets/images/placeholder.svg?fig=${n}`}markAllPartsOwned(n){if(!this.userInventory)return;let i=`Are you sure you want to ${n?"mark all parts as complete":"mark all parts as missing"}? This will update the quantities for all ${this.parts.length} parts in this set.`;if(!confirm(i))return;let t={};for(let[m,f]of Object.entries(this.userInventory.partsOwned))t[m]=typeof f=="number"?f:f?1:0;for(let m of this.parts){let f=this.getPartStorageKey(m.inventoryPart.part_num,m.inventoryPart.color_id,m.inventoryPart.is_spare);t[f]=n?m.quantityNeeded:0,m.quantityOwned=t[f]}let d={};for(let[m,f]of Object.entries(this.userInventory.minifigsOwned))d[m]=typeof f=="number"?f:f?1:0;let p=Q(k({},this.userInventory),{partsOwned:t,minifigsOwned:d,lastUpdated:Date.now()});this.storageService.updateUserInventory(p),this.userInventory=p,this.updateCounts()}markAllMinifigsOwned(n){if(!this.userInventory)return;let i=`Are you sure you want to ${n?"mark all minifigures as complete":"mark all minifigures as missing"}? This will update the quantities for all ${this.minifigs.length} minifigures in this set.`;if(!confirm(i))return;let t={};for(let[m,f]of Object.entries(this.userInventory.partsOwned))t[m]=typeof f=="number"?f:f?1:0;let d={};for(let[m,f]of Object.entries(this.userInventory.minifigsOwned))d[m]=typeof f=="number"?f:f?1:0;for(let m of this.minifigs)d[m.inventoryMinifig.fig_num]=n?m.quantityNeeded:0,m.quantityOwned=d[m.inventoryMinifig.fig_num];let p=Q(k({},this.userInventory),{partsOwned:t,minifigsOwned:d,lastUpdated:Date.now()});this.storageService.updateUserInventory(p),this.userInventory=p,this.updateCounts()}markAllSparePartsOwned(n){if(!this.userInventory)return;let i=`Are you sure you want to ${n?"mark all spare parts as complete":"mark all spare parts as missing"}? This will update the quantities for all ${this.spareParts.length} spare parts in this set.`;if(!confirm(i))return;let t={};for(let[m,f]of Object.entries(this.userInventory.partsOwned))t[m]=typeof f=="number"?f:f?1:0;for(let m of this.spareParts){let f=this.getPartStorageKey(m.inventoryPart.part_num,m.inventoryPart.color_id,m.inventoryPart.is_spare);t[f]=n?m.quantityNeeded:0,m.quantityOwned=t[f]}let d={};for(let[m,f]of Object.entries(this.userInventory.minifigsOwned))d[m]=typeof f=="number"?f:f?1:0;let p=Q(k({},this.userInventory),{partsOwned:t,minifigsOwned:d,lastUpdated:Date.now()});this.storageService.updateUserInventory(p),this.userInventory=p,this.updateCounts()}initializeDefaultSorting(){this.partsSortOptions=[{field:"completion",direction:"asc"},{field:"color",direction:"asc"},{field:"partNumber",direction:"asc"}],this.minifigsSortOptions=[{field:"completion",direction:"asc"},{field:"figNumber",direction:"asc"},{field:"figName",direction:"asc"}],this.sparePartsSortOptions=[{field:"completion",direction:"asc"},{field:"color",direction:"asc"},{field:"partNumber",direction:"asc"}]}loadSortPreferences(){this.userInventory?.sortPreferences&&(this.userInventory.sortPreferences.parts.length>0&&(this.partsSortOptions=[...this.userInventory.sortPreferences.parts]),this.userInventory.sortPreferences.minifigs.length>0&&(this.minifigsSortOptions=[...this.userInventory.sortPreferences.minifigs]),this.userInventory.sortPreferences.spareParts&&this.userInventory.sortPreferences.spareParts.length>0&&(this.sparePartsSortOptions=[...this.userInventory.sortPreferences.spareParts]))}loadViewPreferences(){this.userInventory?.viewPreferences&&(this.partsViewType=this.userInventory.viewPreferences.parts||"tiles",this.minifigsViewType=this.userInventory.viewPreferences.minifigs||"tiles",this.sparePartsViewType=this.userInventory.viewPreferences.spareParts||"tiles")}saveSortPreferences(){if(!this.userInventory)return;let n=Q(k({},this.userInventory),{sortPreferences:{parts:[...this.partsSortOptions],minifigs:[...this.minifigsSortOptions],spareParts:[...this.sparePartsSortOptions]},lastUpdated:Date.now()});this.userInventory=n,this.storageService.updateUserInventory(n)}saveViewPreferences(){if(!this.userInventory)return;let n=Q(k({},this.userInventory),{viewPreferences:{parts:this.partsViewType,minifigs:this.minifigsViewType,spareParts:this.sparePartsViewType},lastUpdated:Date.now()});this.userInventory=n,this.storageService.updateUserInventory(n)}applySorting(){this.parts=this.sortParts([...this.parts]),this.minifigs=this.sortMinifigs([...this.minifigs]),this.spareParts=this.sortSpareParts([...this.spareParts]),this.filterParts()}sortParts(n){try{return n.sort((e,i)=>{for(let t of this.partsSortOptions){let d=this.comparePartsByField(e,i,t.field);if(d!==0)return t.direction==="asc"?d:-d}return 0})}catch(e){return console.error("Error sorting parts:",e),n}}sortMinifigs(n){try{return n.sort((e,i)=>{for(let t of this.minifigsSortOptions){let d=this.compareMinifigsByField(e,i,t.field);if(d!==0)return t.direction==="asc"?d:-d}return 0})}catch(e){return console.error("Error sorting minifigs:",e),n}}sortSpareParts(n){try{return n.sort((e,i)=>{for(let t of this.sparePartsSortOptions){let d=this.compareSparePartsByField(e,i,t.field);if(d!==0)return t.direction==="asc"?d:-d}return 0})}catch(e){return console.error("Error sorting spare parts:",e),n}}comparePartsByField(n,e,i){switch(i){case"completion":let t=n.quantityOwned>=n.quantityNeeded,d=e.quantityOwned>=e.quantityNeeded;return t===d?0:t?1:-1;case"color":let p=String(n.color?.name||""),m=String(e.color?.name||"");return p.localeCompare(m);case"partNumber":let f=String(n.part?.part_num||""),w=String(e.part?.part_num||"");return f.localeCompare(w);case"partName":let x=String(n.part?.name||""),h=String(e.part?.name||"");return x.localeCompare(h);case"elementId":let P=String(n.elementId||""),T=String(e.elementId||"");return P.localeCompare(T);case"quantityMissing":let q=Math.max(0,n.quantityNeeded-n.quantityOwned),V=Math.max(0,e.quantityNeeded-e.quantityOwned);return q-V;case"quantityNeeded":return n.quantityNeeded-e.quantityNeeded;case"setNumber":let $=String(n.setNum||""),U=String(e.setNum||"");return $.localeCompare(U);case"setName":let j=String(n.setName||""),O=String(e.setName||"");return j.localeCompare(O);default:return 0}}compareMinifigsByField(n,e,i){switch(i){case"completion":let t=n.quantityOwned>=n.quantityNeeded,d=e.quantityOwned>=e.quantityNeeded;return t===d?0:t?1:-1;case"figNumber":let p=String(n.minifig?.fig_num||""),m=String(e.minifig?.fig_num||"");return p.localeCompare(m);case"figName":let f=String(n.minifig?.name||""),w=String(e.minifig?.name||"");return f.localeCompare(w);case"quantityMissing":let x=Math.max(0,n.quantityNeeded-n.quantityOwned),h=Math.max(0,e.quantityNeeded-e.quantityOwned);return x-h;case"quantityNeeded":return n.quantityNeeded-e.quantityNeeded;case"setNumber":let P=String(n.setNum||""),T=String(e.setNum||"");return P.localeCompare(T);case"setName":let q=String(n.setName||""),V=String(e.setName||"");return q.localeCompare(V);default:return 0}}compareSparePartsByField(n,e,i){switch(i){case"completion":let t=n.quantityOwned>=n.quantityNeeded,d=e.quantityOwned>=e.quantityNeeded;return t===d?0:t?1:-1;case"color":let p=String(n.color?.name||""),m=String(e.color?.name||"");return p.localeCompare(m);case"partNumber":let f=String(n.part?.part_num||""),w=String(e.part?.part_num||"");return f.localeCompare(w);case"partName":let x=String(n.part?.name||""),h=String(e.part?.name||"");return x.localeCompare(h);case"elementId":let P=String(n.elementId||""),T=String(e.elementId||"");return P.localeCompare(T);case"quantityMissing":let q=Math.max(0,n.quantityNeeded-n.quantityOwned),V=Math.max(0,e.quantityNeeded-e.quantityOwned);return q-V;case"quantityNeeded":return n.quantityNeeded-e.quantityNeeded;case"setNumber":let $=String(n.setNum||""),U=String(e.setNum||"");return $.localeCompare(U);case"setName":let j=String(n.setName||""),O=String(e.setName||"");return j.localeCompare(O);default:return 0}}addSortOption(n){let e=n==="parts"?this.partsSortOptions:n==="minifigs"?this.minifigsSortOptions:this.sparePartsSortOptions;if(e.length<3){let i=n==="parts"?this.partSortFields:n==="minifigs"?this.minifigSortFields:this.partSortFields,t=e.map(p=>p.field),d=i.find(p=>!t.includes(p.value));if(d){let p={field:d.value,direction:"asc"};n==="parts"?this.partsSortOptions.push(p):n==="minifigs"?this.minifigsSortOptions.push(p):this.sparePartsSortOptions.push(p)}}}removeSortOption(n,e){n==="parts"?this.partsSortOptions.splice(e,1):n==="minifigs"?this.minifigsSortOptions.splice(e,1):this.sparePartsSortOptions.splice(e,1)}updateSortOption(n,e,i,t){let d=n==="parts"?this.partsSortOptions:n==="minifigs"?this.minifigsSortOptions:this.sparePartsSortOptions;d[e]&&(d[e]={field:i,direction:t})}applySortChanges(){this.applySorting(),this.saveSortPreferences(),this.closeSortOptions()}resetToDefaultSort(){this.initializeDefaultSorting(),this.applySorting(),this.saveSortPreferences()}getAvailableFields(n,e){let i=n==="parts"?this.partSortFields:n==="minifigs"?this.minifigSortFields:this.partSortFields;if(this.isMissingPartsMode){let m=[{value:"setNumber",label:"Set Number"},{value:"setName",label:"Set Name"}];i=[...i,...m]}let t=n==="parts"?this.partsSortOptions:n==="minifigs"?this.minifigsSortOptions:this.sparePartsSortOptions,d=t[e]?.field,p=t.map((m,f)=>f!==e?m.field:null).filter(m=>m!==null);return i.filter(m=>{let f=m.value;return!p.includes(f)||f===d})}getAllFieldsForDropdown(n){let e=n==="parts"?this.partSortFields:n==="minifigs"?this.minifigSortFields:this.partSortFields;if(this.isMissingPartsMode){let i=[{value:"setNumber",label:"Set Number"},{value:"setName",label:"Set Name"}];e=[...e,...i]}return e}isFieldDisabled(n,e,i){return(n==="parts"?this.partsSortOptions:n==="minifigs"?this.minifigsSortOptions:this.sparePartsSortOptions).some((d,p)=>p!==i&&d.field===e)}getFieldLabel(n,e){let i=n==="parts"?this.partSortFields:n==="minifigs"?this.minifigSortFields:this.partSortFields;if(this.isMissingPartsMode){let d=[{value:"setNumber",label:"Set Number"},{value:"setName",label:"Set Name"}];i=[...i,...d]}let t=i.find(d=>d.value===e);return t?t.label:e}togglePartsView(){this.partsViewType=this.partsViewType==="tiles"?"list":"tiles",this.saveViewPreferences()}toggleMinifigsView(){this.minifigsViewType=this.minifigsViewType==="tiles"?"list":"tiles",this.saveViewPreferences()}toggleSparePartsView(){this.sparePartsViewType=this.sparePartsViewType==="tiles"?"list":"tiles",this.saveViewPreferences()}openImageOverlay(n,e){this.overlayImageUrl=n,this.overlayImageAlt=e,this.showImageOverlay=!0,document.body.style.overflow="hidden"}closeImageOverlay(){this.showImageOverlay=!1,this.overlayImageUrl="",this.overlayImageAlt="",document.body.style.overflow="auto"}onOverlayClick(n){n.target===n.currentTarget&&this.closeImageOverlay()}getImageSizeClasses(){switch(this.globalSettings.imagePreviewSize){case"2x":return"w-32 h-32";case"4x":return"w-64 h-64";default:return"w-16 h-16"}}getListImageSizeClasses(){switch(this.globalSettings.imagePreviewSize){case"2x":return"w-16 h-16";case"4x":return"w-32 h-32";default:return"w-8 h-8"}}shouldUseVerticalLayout(){return this.globalSettings.imagePreviewSize==="4x"}getLargeImageUrl(n){return n.includes("https://cdn.rebrickable.com/media/")&&!n.includes("https://cdn.rebrickable.com/media/thumbs/")?n.replace("https://cdn.rebrickable.com/media/","https://cdn.rebrickable.com/media/thumbs/")+"/800x800p.jpg?"+Date.now():n}onImageError(n){let e=n.target;e.style.display="none"}trackByPartId(n,e){return`${e.part.part_num}_${e.color.id}_${e.inventoryId||"default"}`}trackByMinifigId(n,e){return`${e.minifig.fig_num}_${e.inventoryId||"default"}`}trackBySparePartId(n,e){return`${e.inventoryPart.part_num}_${e.inventoryPart.color_id}`}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}scrollToBottom(){window.scrollTo(0,document.body.scrollHeight)}switchToTab(n){this.activeTab=n,this.showSortOptions=!1,setTimeout(()=>{this.updateSortPanelVisibility()},0)}toggleSortOptions(){this.showSortOptions=!this.showSortOptions,setTimeout(()=>{this.updateSortPanelVisibility()},0)}closeSortOptions(){this.showSortOptions=!1,setTimeout(()=>{this.updateSortPanelVisibility()},0)}updateSortPanelVisibility(){this.showPartsSortOptions=this.showSortOptions&&this.activeTab==="parts",this.showSparePartsSortOptions=this.showSortOptions&&this.activeTab==="spare-parts",this.showMinifigsSortOptions=this.showSortOptions&&this.activeTab==="minifigs"}migrateSparePartsData(n,e){if(!n.partsOwned)return n;let i=!1,t=k({},n.partsOwned);if(e.forEach(d=>{if(d.is_spare){let p=`${d.part_num}_${d.color_id}`,m=this.getPartStorageKey(d.part_num,d.color_id,!0);p in t&&!(m in t)&&(t[m]=t[p],i=!0)}}),i){let d=Q(k({},n),{partsOwned:t,lastUpdated:Date.now()});return this.storageService.updateUserInventory(d),d}return n}preloadAllMinifigParts(){if(!this.minifigs||this.minifigs.length===0)return;let n=this.dataService.getCurrentInventories();this.minifigs.forEach(e=>{let i=e.minifig.fig_num;if(this.minifigPartsCache.has(i))return;let t=n.find(d=>d.set_num===i);t&&this.loadMinifigPartsAsync(i,t.id)})}loadStandardInventoryData(){this.route.paramMap.pipe(H(n=>{let e=n.get("id");return e?this.storageService.getState().pipe(J(i=>(this.globalSettings=k({},i.globalSettings),i.userInventories.find(d=>d.id===e)||null))):R(null)}),H(n=>n?(this.userInventory=n,this.updateCounts(),this.applySorting(),this.filterParts(),this.updateCanUndo(),this.userInventory.minifigPartsOwned||(this.userInventory.minifigPartsOwned={}),this.loadMinifigPartsState(),this.dataService.isDataLoaded().pipe(le(e=>e===!0),H(()=>this.loadInventoryData(n)))):(this.loading=!1,R(null)))).subscribe({next:n=>{n&&(this.parts=n.parts,this.spareParts=n.spareParts,this.minifigs=n.minifigs,this.filteredParts=this.parts,this.set=n.set,this.loadSortPreferences(),this.loadViewPreferences(),this.applySorting(),this.updateCounts(),this.preloadAllMinifigParts()),this.loading=!1},error:n=>{console.error("Error loading inventory details:",n),this.loading=!1}})}loadMissingPartsData(){this.storageService.getState().pipe(H(n=>(this.globalSettings=k({},n.globalSettings),this.userInventories=n.userInventories,this.userInventories.length===0?(this.loading=!1,R(null)):this.dataService.isDataLoaded().pipe(le(e=>e===!0),H(()=>this.loadAllMissingItemsData()))))).subscribe({next:n=>{n&&(this.parts=n.parts,this.spareParts=n.spareParts,this.minifigs=n.minifigs,this.filteredParts=this.parts,this.loadDefaultPreferencesForMissingMode(),this.applySorting(),this.updateCounts(),this.loadMinifigPartsState(),this.preloadAllMinifigParts()),this.loading=!1},error:n=>{console.error("Error loading missing parts data:",n),this.loading=!1}})}loadInventoryData(n){let e=this.dataService.getCurrentInventories(),i=e.filter(x=>x.set_num&&x.set_num.trim()===n.set_num.trim()),t=this.dataService.getCurrentInventories().find(x=>x.set_num&&x.set_num.trim()===n.set_num.trim()&&Number(x.version)===Number(n.version));if(!t)return console.error("InventoryDetailComponent: No inventory found for",n.set_num,"version",n.version),R(null);this.inventory=t;let d=this.dataService.getCurrentSets().find(x=>x.set_num&&x.set_num.trim()===n.set_num.trim()),p=this.dataService.getCurrentInventoryParts(),m=e.filter(x=>x.set_num&&x.set_num.trim()===n.set_num.trim()),f=t,w=p.filter(x=>x.inventory_id===t.id).length;return w===0&&(m.forEach(x=>{let h=p.filter(P=>P.inventory_id===x.id).length;h>w&&(w=h,f=x)}),f.id!==t.id&&(console.log(`Switching from version ${t.version} (${t.id}) to version ${f.version} (${f.id}) which has ${w} parts`),this.inventory=f)),re({inventoryParts:this.dataService.getInventoryPartsFromCache(f.id),inventoryMinifigs:this.dataService.getInventoryMinifigsFromCache(f.id)}).pipe(J(x=>{let{inventoryParts:h,inventoryMinifigs:P}=x;n=this.migrateSparePartsData(n,h);let T=this.dataService.getCurrentParts(),q=this.dataService.getCurrentColors(),V=this.dataService.getCurrentElements(),$=this.dataService.getCurrentMinifigs(),U=new Map(T.map(b=>[b.part_num,b])),j=new Map(q.map(b=>[b.id,b])),O=new Map(V.map(b=>[`${b.part_num}_${b.color_id}`,b.element_id])),z=new Map($.map(b=>[b.fig_num,b])),B=[],K=[];for(let b of h){let L=U.get(b.part_num),ne=j.get(b.color_id);if(L&&ne){let ke=this.getPartStorageKey(b.part_num,b.color_id,b.is_spare),Ve=n.partsOwned[ke]||0,Ne=O.get(`${b.part_num}_${b.color_id}`),de={inventoryPart:b,part:L,color:ne,imageUrl:b.img_url,quantityNeeded:b.quantity,quantityOwned:Ve,elementId:Ne,setName:d?.name,setNum:d?.set_num,inventoryId:t.id.toString()};b.is_spare===!0?K.push(de):B.push(de)}}let Y=[];for(let b of P){let L=z.get(b.fig_num);if(L){let ne=n.minifigsOwned[b.fig_num]||0;Y.push({inventoryMinifig:b,minifig:L,imageUrl:L.img_url,quantityNeeded:b.quantity,quantityOwned:ne,setName:d?.name,setNum:d?.set_num,inventoryId:t.id.toString()})}}let ie=new Set;if([...B,...K].forEach(b=>{ie.add(b.color.id)}),d){let b=this.dataService.getCurrentThemes();this.theme=b.find(L=>L.id===d.theme_id)||null}return this.uniqueColorsCount=ie.size,{parts:B,spareParts:K,minifigs:Y,set:d||null}}))}loadAllMissingItemsData(){let n=this.dataService.getCurrentInventories(),e=this.dataService.getCurrentParts(),i=this.dataService.getCurrentColors(),t=this.dataService.getCurrentElements(),d=this.dataService.getCurrentMinifigs(),p=new Map(e.map(h=>[h.part_num,h])),m=new Map(i.map(h=>[h.id,h])),f=new Map(t.map(h=>[`${h.part_num}_${h.color_id}`,h.element_id])),w=new Map(d.map(h=>[h.fig_num,h])),x=this.userInventories.map(h=>{let P=n.find(T=>T.set_num===h.set_num&&Number(T.version)===Number(h.version));return P?re({inventoryParts:this.dataService.getInventoryPartsFromCache(P.id),inventoryMinifigs:this.dataService.getInventoryMinifigsFromCache(P.id)}).pipe(J(T=>{let{inventoryParts:q,inventoryMinifigs:V}=T,$=[],U=[];for(let O of q){let z=this.getPartStorageKey(O.part_num,O.color_id,O.is_spare),B=h.partsOwned[z]||0;if(B<O.quantity){let K=p.get(O.part_num),Y=m.get(O.color_id);if(K&&Y){let ie=f.get(`${O.part_num}_${O.color_id}`),b={inventoryPart:O,part:K,color:Y,imageUrl:O.img_url,quantityNeeded:O.quantity,quantityOwned:B,elementId:ie,setName:h.name,setNum:h.set_num,inventoryId:h.id};O.is_spare===!0?U.push(b):$.push(b)}}}let j=[];for(let O of V){let z=h.minifigsOwned[O.fig_num]||0;if(z<O.quantity){let B=w.get(O.fig_num);B&&j.push({inventoryMinifig:O,minifig:B,imageUrl:B.img_url,quantityNeeded:O.quantity,quantityOwned:z,setName:h.name,setNum:h.set_num,inventoryId:h.id})}}return{parts:$,spareParts:U,minifigs:j}})):R({parts:[],spareParts:[],minifigs:[]})});return re(x).pipe(J(h=>{let P=[],T=[],q=[];return h.forEach(({parts:V,spareParts:$,minifigs:U})=>{P.push(...V),T.push(...$),q.push(...U)}),{parts:P,spareParts:T,minifigs:q,set:null}}))}loadDefaultPreferencesForMissingMode(){this.initializeDefaultSorting(),this.partsViewType="tiles",this.minifigsViewType="tiles",this.sparePartsViewType="tiles"}ngOnInit(){return _e(this,null,function*(){try{let n=this.route.snapshot,e=n.paramMap.get("id");this.isMissingPartsMode=n.url.some(i=>i.path==="missing-parts"),setTimeout(()=>{this.updateSortPanelVisibility()},0),this.isMissingPartsMode?yield this.loadMissingPartsData():e&&(yield this.loadStandardInventoryData()),this.setupKeyboardListeners()}catch(n){console.error("Error in ngOnInit:",n)}finally{this.loading=!1}})}setupKeyboardListeners(){document.addEventListener("keydown",this.handleKeyDown.bind(this))}ngOnDestroy(){document.removeEventListener("keydown",this.handleKeyDown.bind(this))}handleKeyDown(n){n.key==="z"&&(n.metaKey||n.ctrlKey)&&!n.shiftKey&&(n.preventDefault(),this.performUndo())}addUndoAction(n){this.userInventory&&(this.userInventory.undoHistory||(this.userInventory.undoHistory=[]),this.userInventory.undoHistory.unshift(n),this.userInventory.undoHistory.length>this.maxUndoHistory&&(this.userInventory.undoHistory=this.userInventory.undoHistory.slice(0,this.maxUndoHistory)),this.updateCanUndo(),this.saveUserInventory())}updateCanUndo(){this.canUndo=this.userInventory?.undoHistory&&this.userInventory.undoHistory.length>0||!1}performUndo(){if(!this.userInventory?.undoHistory||this.userInventory.undoHistory.length===0)return;let n=this.userInventory.undoHistory.shift();n&&(n.type==="part"?this.updatePartQuantityInternal(n.key,n.previousQuantity):n.type==="minifig"?this.updateMinifigQuantityInternal(n.key,n.previousQuantity):n.type==="minifig-part"&&this.updateMinifigPartQuantityInternal(n.key,n.previousQuantity),this.updateCanUndo(),this.saveUserInventory(),this.showUndoNotificationMessage(`Undone: ${n.description}`))}showUndoNotificationMessage(n){this.undoNotificationMessage=n,this.showUndoNotification=!0,setTimeout(()=>{this.showUndoNotification=!1},3e3)}saveUserInventory(){this.userInventory&&this.storageService.updateUserInventory(this.userInventory)}updatePartQuantityInternal(n,e){if(!this.userInventory)return;this.userInventory.partsOwned[n]=e;let i=this.parts.find(d=>this.getPartStorageKey(d.inventoryPart.part_num,d.inventoryPart.color_id,d.inventoryPart.is_spare)===n);i&&(i.quantityOwned=e);let t=this.spareParts.find(d=>this.getPartStorageKey(d.inventoryPart.part_num,d.inventoryPart.color_id,d.inventoryPart.is_spare)===n);t&&(t.quantityOwned=e),this.updateCounts(),this.filterParts()}updateMinifigQuantityInternal(n,e){if(!this.userInventory)return;this.userInventory.minifigsOwned[n]=e;let i=this.minifigs.find(t=>t.inventoryMinifig.fig_num===n);i&&(i.quantityOwned=e),this.updateCounts()}updateMinifigPartQuantityInternal(n,e){if(!this.userInventory)return;this.userInventory.minifigPartsOwned[n]=e;let i=n.split("_");if(i.length>=4){let t=i[1],d=i[2],p=Number(i[3]),m=this.minifigPartsCache.get(t);if(m){let f=m.find(w=>w.inventoryPart.part_num===d&&w.inventoryPart.color_id===p);f&&(f.quantityOwned=e,this.minifigPartsCache.set(t,this.sortMinifigParts([...m])))}}this.updateCounts()}static \u0275fac=function(e){return new(e||o)(Z(we),Z(Te),Z(Se),Z(ve))};static \u0275cmp=ce({type:o,selectors:[["app-inventory-detail"]],decls:18,vars:9,consts:[["noPartsFound",""],["noSpareParts",""],["noMinifigs",""],[2,"width","100%","max-width","none","display","block"],["class","flex items-center justify-center py-16 px-4 min-h-screen bg-gray-50",4,"ngIf"],["class","bg-white shadow-md rounded-lg p-6 max-w-4xl mx-auto my-8",4,"ngIf"],["class","bg-white py-8 w-full min-h-screen","style","min-width: 600px;",4,"ngIf"],["class","bg-white py-8 w-full min-h-screen","style","min-width: 600px; width: 100%; max-width: none;",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",3,"click",4,"ngIf"],[1,"fixed","bottom-6","right-6","flex","flex-col","space-y-3","z-40"],["title","Scroll to top",1,"w-12","h-12","bg-blue-600","hover:bg-blue-700","text-white","rounded-full","shadow-lg","flex","items-center","justify-center","transition-all","duration-200","hover:scale-110",3,"click"],[1,"text-lg"],["title","Scroll to bottom",1,"w-12","h-12","bg-blue-600","hover:bg-blue-700","text-white","rounded-full","shadow-lg","flex","items-center","justify-center","transition-all","duration-200","hover:scale-110",3,"click"],[1,"relative"],["class","w-12 h-12 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-100 disabled:hover:scale-100",3,"disabled","title","click",4,"ngIf"],["class","absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",4,"ngIf"],["class","fixed top-20 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300",4,"ngIf"],[1,"flex","items-center","justify-center","py-16","px-4","min-h-screen","bg-gray-50"],[1,"text-center"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-600","mx-auto","mb-4"],["class","text-gray-600 mb-2",4,"ngIf"],[1,"text-sm","text-gray-500"],[1,"text-xs","text-gray-400","mt-2"],[1,"text-gray-600","mb-2"],[1,"bg-white","shadow-md","rounded-lg","p-6","max-w-4xl","mx-auto","my-8"],[1,"text-2xl","font-bold","text-gray-800","mb-4"],[1,"text-gray-600","mb-6"],["routerLink","/sets",1,"bg-blue-600","text-white","px-4","py-2","rounded-md","hover:bg-blue-700","transition"],[1,"bg-white","py-8","w-full","min-h-screen",2,"min-width","600px"],[1,"px-1","sm:px-2","text-center","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"text-lg","text-gray-600","mb-4"],[1,"bg-white","py-8","w-full","min-h-screen",2,"min-width","600px","width","100%","max-width","none"],[1,"px-1","sm:px-2"],["class","mb-6 flex flex-col md:flex-row md:items-center md:justify-between",4,"ngIf"],["class","mb-6",4,"ngIf"],[1,"border-b","border-gray-200","mb-6"],[1,"flex","space-x-8"],[1,"py-4","px-1","border-b-2","font-medium","text-sm","focus:outline-none",3,"click"],[4,"ngIf"],["class","ml-1 text-red-500",4,"ngIf"],[1,"mb-6","flex","flex-col","md:flex-row","md:items-center","md:justify-between"],[1,"flex","items-start","space-x-4"],["class","flex-shrink-0",4,"ngIf"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-800"],[1,"text-gray-600","mt-1"],[1,"flex","flex-wrap","gap-4","mt-2","text-sm","text-gray-600"],[1,"text-gray-500","text-sm","mt-1"],[1,"mt-4"],[1,"mt-4","md:mt-0","flex","flex-col","md:flex-row","md:items-center","space-y-2","md:space-y-0","md:space-x-4"],["target","_blank","rel","noopener noreferrer",1,"text-green-600","hover:underline","flex","items-center",3,"href"],[1,"mr-1"],["routerLink","/sets",1,"text-blue-600","hover:underline"],[1,"flex-shrink-0"],[1,"w-24","h-24","bg-gray-100","rounded-lg","overflow-hidden","flex","items-center","justify-center","cursor-pointer",3,"click"],[1,"w-full","h-full","object-contain","hover:opacity-80","transition-opacity",3,"error","src","alt"],[1,"text-center","mt-1"],[1,"text-xs","text-gray-400"],["href","https://rebrickable.com","target","_blank","rel","noopener noreferrer",1,"text-blue-500","hover:text-blue-400"],[1,"flex","justify-between","text-sm","text-gray-600","mb-1"],[1,"w-full","bg-gray-200","rounded-full","h-3"],[1,"h-3","rounded-full","transition-all","duration-300"],[1,"space-y-3"],[1,"flex","justify-between","text-sm","text-gray-500","mb-1"],[1,"w-full","bg-gray-200","rounded-full","h-2"],[1,"h-2","rounded-full","transition-all","duration-300"],[1,"mb-6"],[1,"flex","flex-col","md:flex-row","md:items-center","md:justify-between"],[1,"text-3xl","font-bold","text-gray-800","mb-2"],[1,"text-gray-600"],[1,"text-sm","text-gray-500","mt-2"],[1,"mt-4","md:mt-0"],[1,"ml-1","text-red-500"],[1,"flex","flex-col","md:flex-row","md:items-center","mb-6","space-y-4","md:space-y-0","md:space-x-4"],["type","text","placeholder","Search parts...",1,"px-4","py-2","border","rounded-md","w-full","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"flex","space-x-2"],[1,"flex","border","rounded-md","overflow-hidden"],[1,"px-3","py-2","text-sm","transition",3,"click"],[1,"bg-gray-600","text-white","px-3","py-2","rounded-md","hover:bg-gray-700","transition","text-sm",3,"click"],[1,"bg-green-600","text-white","px-3","py-2","rounded-md","hover:bg-green-700","transition","text-sm",3,"click"],[1,"bg-red-600","text-white","px-3","py-2","rounded-md","hover:bg-red-700","transition","text-sm",3,"click"],["class","bg-gray-50 border rounded-lg p-4 mb-6",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"bg-gray-50","border","rounded-lg","p-4","mb-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-medium","text-gray-800"],[1,"text-sm","text-blue-600","hover:underline",3,"click"],["class","flex items-center space-x-3",4,"ngFor","ngForOf"],["class","flex justify-start",4,"ngIf"],[1,"flex","justify-end","space-x-2","mt-4"],[1,"px-4","py-2","text-gray-600","hover:text-gray-800","text-sm",3,"click"],[1,"bg-blue-600","text-white","px-4","py-2","rounded","hover:bg-blue-700","transition","text-sm",3,"click"],[1,"flex","items-center","space-x-3"],[1,"text-sm","font-medium","text-gray-700","w-8"],[1,"flex-1","px-3","py-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-sm",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"px-3","py-2","border","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-sm",3,"change","value"],["value","asc"],["value","desc"],["class","text-red-600 hover:text-red-800 text-sm px-2 py-1",3,"click",4,"ngIf"],[3,"value","disabled"],[1,"text-red-600","hover:text-red-800","text-sm","px-2","py-1",3,"click"],[1,"flex","justify-start"],[1,"text-blue-600","hover:text-blue-800","text-sm",3,"click"],["class","grid gap-2 sm:gap-3 md:gap-4","style","grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));",4,"ngIf"],["class","bg-white border rounded-lg overflow-hidden w-full",4,"ngIf"],[1,"grid","gap-2","sm:gap-3","md:gap-4",2,"grid-template-columns","repeat(auto-fill, minmax(240px, 1fr))"],["class","border rounded-lg overflow-hidden",3,"bg-green-50","bg-yellow-50","bg-red-50",4,"ngFor","ngForOf","ngForTrackBy"],[1,"border","rounded-lg","overflow-hidden"],[1,"p-4"],[3,"click"],[1,"w-full","h-full","object-contain","hover:opacity-80","transition-opacity",3,"src","alt"],[1,"font-medium","text-gray-800"],[1,"text-sm","text-gray-600"],["class","text-sm text-gray-600",4,"ngIf"],["class","text-sm text-blue-600 font-medium",4,"ngIf"],[1,"mb-3"],[1,"flex","items-center","space-x-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"flex","items-center","space-x-1"],[1,"w-8","h-8","rounded-full","bg-gray-200","hover:bg-gray-300","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-sm","font-bold",3,"click","disabled"],["type","number",1,"w-16","px-2","py-1","text-center","border","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-sm",3,"input","focus","value","min","max"],[1,"flex","items-center","justify-center","space-x-2","mt-2"],["title","Mark as complete",1,"w-8","h-6","rounded","bg-green-500","hover:bg-green-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-white","text-xs","font-bold",3,"click","disabled"],["title","Clear quantity",1,"w-8","h-6","rounded","bg-red-500","hover:bg-red-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-white","text-xs","font-bold",3,"click","disabled"],[1,"mt-3","text-center"],[1,"text-sm","font-medium"],[1,"text-sm","text-blue-600","font-medium"],[1,"bg-white","border","rounded-lg","overflow-hidden","w-full"],[1,"overflow-x-auto"],[1,"w-full","divide-y","divide-gray-200","table-auto"],[1,"bg-gray-50"],[1,"px-2","py-2","text-left","text-sm","font-medium","text-gray-500","uppercase","tracking-wider","w-48"],[1,"px-2","py-2","text-left","text-sm","font-medium","text-gray-500","uppercase","tracking-wider","w-28"],["class","px-2 py-2 text-left text-sm font-medium text-gray-500 uppercase tracking-wider w-32",4,"ngIf"],[1,"px-2","py-2","text-left","text-sm","font-medium","text-gray-500","uppercase","tracking-wider","w-32"],[1,"px-2","py-2","text-left","text-sm","font-medium","text-gray-500","uppercase","tracking-wider","w-36"],[1,"px-2","py-2","text-left","text-sm","font-medium","text-gray-500","uppercase","tracking-wider","w-24"],[1,"bg-white","divide-y","divide-gray-200"],[3,"bg-green-50","bg-yellow-50","bg-red-50",4,"ngFor","ngForOf","ngForTrackBy"],[1,"px-2","py-2","w-48"],[1,"flex","items-center"],[1,"min-w-0","flex-1"],[1,"text-sm","font-medium","text-gray-900"],[1,"px-2","py-2","whitespace-nowrap","w-28"],[1,"text-sm","text-gray-900","truncate"],["class","px-2 py-2 whitespace-nowrap w-32",4,"ngIf"],[1,"px-2","py-2","whitespace-nowrap","w-32"],[1,"w-full","bg-gray-200","rounded-full","h-1.5","mb-1"],[1,"h-1.5","rounded-full","transition-all","duration-300"],[1,"text-sm","text-gray-500","text-center"],[1,"px-2","py-2","whitespace-nowrap","w-36"],[1,"flex","items-center","justify-center","space-x-1"],[1,"w-6","h-6","rounded-full","bg-gray-200","hover:bg-gray-300","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-sm","font-bold","border","flex-shrink-0",3,"click","disabled"],["type","number",1,"w-10","px-1","py-0.5","text-center","border","rounded","focus:outline-none","focus:ring-1","focus:ring-blue-500","text-sm","flex-shrink-0",3,"input","focus","value","min","max"],[1,"px-2","py-2","whitespace-nowrap","w-24","text-center"],["title","Mark as complete",1,"w-6","h-5","rounded","bg-green-500","hover:bg-green-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-white","text-xs","font-bold",3,"click","disabled"],["title","Clear quantity",1,"w-6","h-5","rounded","bg-red-500","hover:bg-red-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-white","text-xs","font-bold",3,"click","disabled"],[1,"text-center","py-8","bg-gray-50","rounded-lg"],[1,"text-lg","text-gray-600"],["class","mt-4 text-blue-600 hover:underline",3,"click",4,"ngIf"],[1,"mt-4","text-blue-600","hover:underline",3,"click"],[1,"text-sm","text-orange-600"],[1,"px-2","py-2","text-left","text-sm","font-medium","text-gray-500","uppercase","tracking-wider","w-20"],[1,"mt-4","text-center"],[1,"bg-blue-600","text-white","px-3","py-2","rounded-md","hover:bg-blue-700","transition","text-sm","flex","items-center","mx-auto",3,"click"],["class","mr-1",4,"ngIf"],["class","border-t border-gray-200 mt-2",4,"ngIf"],[1,"border-t","border-gray-200","mt-2"],[1,"p-4","bg-gray-50"],[1,"text-sm","font-medium","text-gray-800","mb-3"],[1,"grid","gap-2",2,"grid-template-columns","repeat(auto-fill, minmax(180px, 1fr))"],["class","border rounded-lg overflow-hidden bg-white",3,"bg-green-50","bg-yellow-50","bg-red-50",4,"ngFor","ngForOf"],[1,"border","rounded-lg","overflow-hidden","bg-white"],[1,"p-3"],[1,"flex","items-start","mb-3"],[1,"w-12","h-12","bg-gray-100","rounded","overflow-hidden","mr-3","flex-shrink-0","cursor-pointer",3,"click"],[1,"flex-1","min-w-0"],[1,"text-xs","font-medium","text-gray-800","truncate"],[1,"text-xs","text-gray-600","truncate"],[1,"mb-2"],[1,"flex","justify-between","text-xs","text-gray-600","mb-1"],[1,"w-full","bg-gray-200","rounded-full","h-1.5"],[1,"w-6","h-6","rounded-full","bg-gray-200","hover:bg-gray-300","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-xs","font-bold",3,"click","disabled"],["type","number",1,"w-12","px-1","py-0.5","text-center","border","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-xs",3,"input","focus","value","min","max"],[1,"mt-2","text-center"],[1,"text-xs","font-medium"],[1,"flex","items-center","justify-center","space-x-1","mt-2"],["title","Mark as complete",1,"w-6","h-4","rounded","bg-green-500","hover:bg-green-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-white","text-xs","font-bold",3,"click","disabled"],["title","Clear quantity",1,"w-6","h-4","rounded","bg-red-500","hover:bg-red-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-white","text-xs","font-bold",3,"click","disabled"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"px-2","py-2","whitespace-nowrap","w-24"],[1,"text-sm","text-gray-900"],[1,"bg-blue-600","text-white","px-2","py-1","rounded","text-xs","hover:bg-blue-700","transition","flex","items-center",3,"click"],["class","bg-gray-50",4,"ngIf"],[1,"px-2","py-4"],[1,"pl-6"],[1,"bg-white","border","rounded","overflow-hidden"],[1,"w-full","divide-y","divide-gray-200"],[1,"bg-gray-100"],[1,"px-2","py-2","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[3,"bg-green-50","bg-yellow-50","bg-red-50",4,"ngFor","ngForOf"],[1,"px-2","py-2"],[1,"w-8","h-8","bg-gray-100","rounded","overflow-hidden","mr-2","flex-shrink-0","cursor-pointer",3,"click"],[1,"text-xs","font-medium","text-gray-900","truncate"],[1,"text-xs","text-gray-500","truncate"],[1,"px-2","py-2","whitespace-nowrap"],[1,"text-xs","text-gray-900","truncate"],[1,"w-full","bg-gray-200","rounded-full","h-1","mb-1"],[1,"h-1","rounded-full","transition-all","duration-300"],[1,"text-xs","text-gray-500","text-center"],[1,"w-5","h-5","rounded-full","bg-gray-200","hover:bg-gray-300","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-xs","font-bold",3,"click","disabled"],["type","number",1,"w-8","px-1","py-0.5","text-center","border","rounded","focus:outline-none","focus:ring-1","focus:ring-blue-500","text-xs",3,"input","focus","value","min","max"],[1,"px-2","py-2","whitespace-nowrap","text-center"],["title","Mark as complete",1,"w-5","h-4","rounded","bg-green-500","hover:bg-green-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-white","text-xs","font-bold",3,"click","disabled"],["title","Clear quantity",1,"w-5","h-4","rounded","bg-red-500","hover:bg-red-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","text-white","text-xs","font-bold",3,"click","disabled"],[1,"fixed","inset-0","bg-black","bg-opacity-75","flex","items-center","justify-center","z-50",3,"click"],[1,"relative","max-w-4xl","max-h-4xl","p-4"],[1,"absolute","top-2","right-2","text-white","hover:text-gray-300","text-2xl","font-bold","z-10","bg-black","bg-opacity-50","rounded-full","w-8","h-8","flex","items-center","justify-center",3,"click"],[1,"max-w-full","max-h-full","object-contain",2,"max-width","800px","max-height","800px",3,"src","alt"],[1,"absolute","bottom-2","left-2","right-2","bg-black","bg-opacity-75","text-white","text-xs","p-2","rounded"],["href","https://rebrickable.com","target","_blank","rel","noopener noreferrer",1,"text-blue-300","hover:text-blue-100","underline"],[1,"w-12","h-12","bg-orange-600","hover:bg-orange-700","disabled:bg-gray-400","disabled:cursor-not-allowed","text-white","rounded-full","shadow-lg","flex","items-center","justify-center","transition-all","duration-200","hover:scale-100","disabled:hover:scale-100",3,"click","disabled","title"],[1,"absolute","-top-1","-right-1","bg-red-500","text-white","text-xs","rounded-full","w-5","h-5","flex","items-center","justify-center","font-bold"],[1,"fixed","top-20","left-1/2","transform","-translate-x-1/2","bg-green-600","text-white","px-6","py-3","rounded-lg","shadow-lg","z-50","transition-all","duration-300"]],template:function(e,i){e&1&&(r(0,"div",3),y(1,Fe,9,2,"div",4)(2,Ae,7,0,"div",5)(3,Qe,8,0,"div",6)(4,je,8,0,"div",6)(5,yi,21,32,"div",7)(6,xi,10,2,"div",8),r(7,"div",9)(8,"button",10),g("click",function(){return i.scrollToTop()}),r(9,"span",11),l(10,"\u2191"),a()(),r(11,"button",12),g("click",function(){return i.scrollToBottom()}),r(12,"span",11),l(13,"\u2193"),a()(),r(14,"div",13),y(15,hi,3,2,"button",14)(16,wi,2,1,"span",15),a()(),y(17,bi,6,1,"div",16),a()),e&2&&(s(),c("ngIf",i.loading),s(),c("ngIf",!i.loading&&!i.userInventory&&!i.isMissingPartsMode),s(),c("ngIf",!i.loading&&i.isMissingPartsMode&&i.userInventories.length===0),s(),c("ngIf",!i.loading&&i.isMissingPartsMode&&i.userInventories.length>0&&i.parts.length===0&&i.spareParts.length===0&&i.minifigs.length===0),s(),c("ngIf",!i.loading&&(!i.isMissingPartsMode&&i.userInventory||i.isMissingPartsMode&&i.userInventories.length>0&&(i.parts.length>0||i.spareParts.length>0||i.minifigs.length>0))),s(),c("ngIf",i.showImageOverlay),s(9),c("ngIf",!i.isMissingPartsMode),s(),c("ngIf",!i.isMissingPartsMode&&i.canUndo&&((i.userInventory==null||i.userInventory.undoHistory==null?null:i.userInventory.undoHistory.length)||0)>0),s(),c("ngIf",i.showUndoNotification))},dependencies:[he,ge,fe,xe,ye,be,De,Me,Ee,Ie,Oe,Pe,Ce],encapsulation:2})};export{qe as InventoryDetailComponent};
