import{a as A}from"./chunk-7M2KBXID.js";import{g as M}from"./chunk-7QI4OYGD.js";import{a as z}from"./chunk-ZCWAUGG7.js";import{Aa as h,Cb as E,Ea as I,Eb as D,Fb as T,Gb as k,Hb as V,Ia as m,Oa as l,Pa as C,Pb as B,Qa as p,Ra as _,Sa as i,Ta as t,Ua as u,Ya as g,Za as S,a as w,aa as x,c,cb as a,db as v,eb as f,fb as P,nb as b,ob as y,wa as s}from"./chunk-YYQQFFP3.js";function L(o,n){o&1&&(x(),i(0,"svg",40),u(1,"path",41),t())}function R(o,n){o&1&&(x(),i(0,"svg",42),u(1,"path",43),t())}function j(o,n){if(o&1&&(i(0,"div",33)(1,"div",34)(2,"div",35),m(3,L,2,0,"svg",36)(4,R,2,0,"svg",37),t(),i(5,"div",38)(6,"p",39),a(7),t()()()()),o&2){let r=S();l("ngClass",r.message.type==="success"?"bg-green-100 border-green-400 text-green-700":"bg-red-100 border-red-400 text-red-700"),s(3),l("ngIf",r.message.type==="success"),s(),l("ngIf",r.message.type==="error"),s(3),v(r.message.text)}}function G(o,n){o&1&&(i(0,"p",14),a(1," The app caches building block parts, sets, and inventory data locally for better performance. The cache is automatically refreshed every 12 hours, but you can manually refresh it if needed. "),t())}function N(o,n){o&1&&(i(0,"p",14),a(1," Your browser doesn't support IndexedDB, so building block data is loaded fresh from CSV files each time you visit. This ensures you always have the latest data but may result in longer loading times. "),t())}function O(o,n){if(o&1&&(i(0,"div",44)(1,"div")(2,"span",45),a(3,"Last updated:"),t(),a(4),b(5,"date"),t(),i(6,"div")(7,"span",45),a(8,"Age:"),t(),a(9),t()()),o&2){let r=S();s(4),f(" ",y(5,2,r.csvCacheInfo.timestamp,"medium")," "),s(5),f(" ",r.formatCacheAge(r.csvCacheInfo.age)," ")}}function q(o,n){o&1&&(i(0,"div",46),a(1," No cached data found. Data will be loaded from CSV files on next page refresh. "),t())}function $(o,n){o&1&&(i(0,"div",46),a(1," Caching not available - data loads fresh from CSV files each visit. "),t())}function Y(o,n){o&1&&u(0,"div",47)}function H(o,n){o&1&&(i(0,"span"),a(1,"This will download fresh CSV data from the server and update the cache."),t())}function K(o,n){o&1&&(i(0,"span"),a(1,"This will reload the page with fresh CSV data from the server."),t())}function W(o,n){if(o&1&&(i(0,"div",5)(1,"h2",6),a(2,"Storage Information"),t(),i(3,"div",7)(4,"div",15)(5,"div",48)(6,"span",23),a(7,"Storage Usage"),t(),i(8,"span",49),a(9),t()(),i(10,"div",50),u(11,"div",51),t(),i(12,"div",52),a(13),b(14,"number"),t()(),i(15,"div",53)(16,"div",54)(17,"div",55),a(18,"Storage Type"),t(),i(19,"div",49),a(20),t()(),i(21,"div",54)(22,"div",55),a(23,"Data Components"),t(),i(24,"div",49)(25,"div"),a(26,"\u2022 Your inventory data"),t(),i(27,"div"),a(28,"\u2022 Building Block CSV data cache"),t(),i(29,"div"),a(30,"\u2022 Application settings"),t()()()(),i(31,"p",56),a(32," Storage is managed automatically. CSV cache helps reduce loading times and data usage. "),t()()()),o&2){let r=S();s(9),P("",r.formatBytes(r.storageInfo.used)," / ",r.formatBytes(r.storageInfo.quota),""),s(2),C("width",r.getStoragePercentage(),"%"),p("bg-green-500",r.getStoragePercentage()<70)("bg-yellow-500",r.getStoragePercentage()>=70&&r.getStoragePercentage()<90)("bg-red-500",r.getStoragePercentage()>=90),s(2),f(" ",y(14,12,r.getStoragePercentage(),"1.1-1"),"% used "),s(7),v(r.storageInfo.type)}}var F=class o{constructor(n,r,e){this.storageService=n;this.exportService=r;this.dataService=e}message=null;selectedFile=null;globalSettings={imagePreviewSize:"1x",includeSparePartsInProgress:!0};storageInfo=null;isUsingIndexedDB=!1;csvCacheInfo=null;isRefreshingCSV=!1;ngOnInit(){return c(this,null,function*(){this.storageService.getState().subscribe(n=>{this.globalSettings=w({},n.globalSettings)}),yield this.loadStorageInfo(),this.isUsingIndexedDB=this.storageService.isUsingIndexedDB(),yield this.loadCSVCacheInfo()})}loadStorageInfo(){return c(this,null,function*(){try{this.storageInfo=yield this.storageService.getStorageInfo()}catch(n){console.error("Failed to load storage info:",n)}})}loadCSVCacheInfo(){return c(this,null,function*(){try{this.csvCacheInfo=yield this.dataService.getCSVCacheInfo()}catch(n){console.error("Failed to load CSV cache info:",n)}})}updateImagePreviewSize(n){this.globalSettings.imagePreviewSize=n,this.storageService.updateGlobalSettings({imagePreviewSize:n}),this.showMessage(`Image preview size updated to ${n}`,"success")}updateIncludeSparePartsInProgress(n){this.globalSettings.includeSparePartsInProgress=n,this.storageService.updateGlobalSettings({includeSparePartsInProgress:n}),this.showMessage(n?"Spare parts will now be included in progress calculations":"Spare parts will now be excluded from progress calculations","success")}exportData(){try{this.exportService.exportData(),this.showMessage("Data exported successfully. Download started.","success")}catch(n){console.error("Error exporting data:",n),this.showMessage("Failed to export data. Please try again.","error")}}onFileSelected(n){let r=n.target;r.files&&r.files.length>0?this.selectedFile=r.files[0]:this.selectedFile=null}importData(){return c(this,null,function*(){if(!this.selectedFile){this.showMessage("Please select a file to import.","error");return}try{(yield this.exportService.importData(this.selectedFile))?(this.showMessage("Data imported successfully.","success"),this.selectedFile=null,yield this.loadStorageInfo()):this.showMessage("Failed to import data. Invalid file format.","error")}catch(n){console.error("Error importing data:",n),this.showMessage("An error occurred while importing data.","error")}})}clearAllData(){return c(this,null,function*(){if(confirm("Are you sure you want to clear all your data? This action cannot be undone."))try{yield this.storageService.clearAllData(),this.showMessage("All data cleared successfully.","success"),yield this.loadStorageInfo(),setTimeout(()=>window.location.reload(),1e3)}catch(n){console.error("Error clearing data:",n),this.showMessage("Failed to clear data. Please try again.","error")}})}refreshCSVData(){return c(this,null,function*(){if(confirm("Are you sure you want to refresh the CSV data? This will download the latest data from the server and may take a few minutes.")){this.isRefreshingCSV=!0;try{(yield this.dataService.refreshCSVData())?(this.showMessage("CSV data refreshed successfully from server.","success"),yield this.loadCSVCacheInfo(),yield this.loadStorageInfo()):this.showMessage("Failed to refresh CSV data. Please try again.","error")}catch(n){console.error("Error refreshing CSV data:",n),this.showMessage("An error occurred while refreshing CSV data.","error")}finally{this.isRefreshingCSV=!1}}})}clearAllDataIncludingCache(){return c(this,null,function*(){if(confirm("Are you sure you want to clear ALL data including CSV cache? This will force a complete reload of all data on next visit and cannot be undone."))try{yield this.storageService.clearAllDataIncludingCache(),this.showMessage("All data including cache cleared successfully.","success"),yield this.loadStorageInfo(),yield this.loadCSVCacheInfo(),setTimeout(()=>window.location.reload(),1e3)}catch(n){console.error("Error clearing all data:",n),this.showMessage("Failed to clear all data. Please try again.","error")}})}formatBytes(n){if(n===0)return"0 Bytes";let r=1024,e=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(n)/Math.log(r));return parseFloat((n/Math.pow(r,d)).toFixed(2))+" "+e[d]}getStoragePercentage(){return!this.storageInfo||this.storageInfo.quota===0?0:this.storageInfo.used/this.storageInfo.quota*100}formatCacheAge(n){if(!n)return"Unknown";let r=n/(1e3*60*60);if(r<1){let e=n/6e4;return`${Math.round(e)} minutes ago`}else{if(r<24)return`${Math.round(r*10)/10} hours ago`;{let e=r/24;return`${Math.round(e*10)/10} days ago`}}}getCacheStatusText(){return this.isUsingIndexedDB?this.csvCacheInfo?this.csvCacheInfo.exists?this.csvCacheInfo.isValid?"Valid":"Expired (>12 hours old)":"No cache found":"Unknown":"No caching (IndexedDB unavailable)"}getCacheStatusClass(){return!this.isUsingIndexedDB||!this.csvCacheInfo?"text-gray-500":this.csvCacheInfo.exists?this.csvCacheInfo.isValid?"text-green-600":"text-orange-600":"text-red-600"}showMessage(n,r){this.message={text:n,type:r},setTimeout(()=>{this.message=null},5e3)}static \u0275fac=function(r){return new(r||o)(h(B),h(A),h(z))};static \u0275cmp=I({type:o,selectors:[["app-settings"]],decls:82,vars:56,consts:[[1,"py-8"],[1,"max-w-4xl","mx-auto"],[1,"bg-white","shadow-md","rounded-lg","p-6"],[1,"text-3xl","font-bold","text-gray-800","mb-6"],["class","border-l-4 p-4 mb-6 rounded",3,"ngClass",4,"ngIf"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[1,"bg-gray-50","p-4","rounded-lg"],[1,"mb-6"],[1,"font-medium","text-gray-800","mb-2"],[1,"text-gray-600","text-sm","mb-3"],[1,"flex","space-x-2"],[1,"px-4","py-2","rounded","transition",3,"click"],[1,"text-xs","text-gray-500","mt-2"],[1,"text-gray-600","text-sm","mb-4"],[1,"mb-4"],[1,"w-full","px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700",3,"click"],["type","file","accept",".json",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","mb-2",3,"change"],[1,"w-full","px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","disabled:bg-gray-400","disabled:cursor-not-allowed",3,"click","disabled"],[1,"mb-6","border-t","pt-6"],["class","text-gray-600 text-sm mb-4",4,"ngIf"],[1,"bg-white","border","rounded-lg","p-4","mb-4"],[1,"flex","justify-between","items-start","mb-2"],[1,"font-medium","text-gray-700"],["class","text-sm text-gray-600 space-y-1",4,"ngIf"],["class","text-sm text-gray-600",4,"ngIf"],[1,"w-full","px-4","py-2","bg-orange-600","text-white","rounded-md","hover:bg-orange-700","disabled:bg-gray-400","disabled:cursor-not-allowed","flex","items-center","justify-center",3,"click","disabled"],["class","animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2",4,"ngIf"],[4,"ngIf"],[1,"border-t","pt-6"],[1,"w-full","px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","mb-2",3,"click"],[1,"w-full","px-4","py-2","bg-red-800","text-white","rounded-md","hover:bg-red-900",3,"click"],["class","mb-8",4,"ngIf"],[1,"border-l-4","p-4","mb-6","rounded",3,"ngClass"],[1,"flex"],[1,"flex-shrink-0"],["class","h-5 w-5 text-green-400","viewBox","0 0 20 20","fill","currentColor",4,"ngIf"],["class","h-5 w-5 text-red-400","viewBox","0 0 20 20","fill","currentColor",4,"ngIf"],[1,"ml-3"],[1,"text-sm"],["viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-green-400"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],["viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-red-400"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-sm","text-gray-600","space-y-1"],[1,"font-medium"],[1,"text-sm","text-gray-600"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-gray-600"],[1,"w-full","bg-gray-200","rounded-full","h-3"],[1,"h-3","rounded-full","transition-all","duration-300"],[1,"text-sm","text-gray-600","mt-1"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm"],[1,"bg-white","p-3","rounded","border"],[1,"font-medium","text-gray-700","mb-1"],[1,"text-xs","text-gray-500","mt-3"]],template:function(r,e){r&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"Settings"),t(),m(5,j,8,4,"div",4),i(6,"div",5)(7,"h2",6),a(8,"Display Preferences"),t(),i(9,"div",7)(10,"div",8)(11,"h3",9),a(12,"Image Preview Size"),t(),i(13,"p",10),a(14," Choose how large part and minifig images appear in the inventory view. "),t(),i(15,"div",11)(16,"button",12),g("click",function(){return e.updateImagePreviewSize("1x")}),a(17," 1x (Small) "),t(),i(18,"button",12),g("click",function(){return e.updateImagePreviewSize("2x")}),a(19," 2x (Medium) "),t(),i(20,"button",12),g("click",function(){return e.updateImagePreviewSize("4x")}),a(21," 4x (Extra Large) "),t()()(),i(22,"div",8)(23,"h3",9),a(24,"Progress Calculation"),t(),i(25,"p",10),a(26," Choose whether spare parts are included in overall set completion percentages. "),t(),i(27,"div",11)(28,"button",12),g("click",function(){return e.updateIncludeSparePartsInProgress(!0)}),a(29," Include Spare Parts "),t(),i(30,"button",12),g("click",function(){return e.updateIncludeSparePartsInProgress(!1)}),a(31," Exclude Spare Parts "),t()(),i(32,"p",13),a(33," When excluded, spare parts will be shown separately and won't affect the main completion percentage. "),t()()()(),i(34,"div",5)(35,"h2",6),a(36,"Data Management"),t(),i(37,"div",7)(38,"div",8)(39,"h3",9),a(40,"Backup & Restore"),t(),i(41,"p",14),a(42," Export your inventory data for backup or import data from a previous backup. "),t(),i(43,"div",15)(44,"button",16),g("click",function(){return e.exportData()}),a(45," Export Data "),t()(),i(46,"div",15)(47,"input",17),g("change",function(U){return e.onFileSelected(U)}),t(),i(48,"button",18),g("click",function(){return e.importData()}),a(49," Import Data "),t()()(),i(50,"div",19)(51,"h3",9),a(52,"Building Block Data Cache"),t(),m(53,G,2,0,"p",20)(54,N,2,0,"p",20),i(55,"div",21)(56,"div",22)(57,"span",23),a(58,"Cache Status:"),t(),i(59,"span"),a(60),t()(),m(61,O,10,5,"div",24)(62,q,2,0,"div",25)(63,$,2,0,"div",25),t(),i(64,"button",26),g("click",function(){return e.refreshCSVData()}),m(65,Y,1,0,"div",27),a(66),t(),i(67,"p",13),m(68,H,2,0,"span",28)(69,K,2,0,"span",28),t()(),i(70,"div",29)(71,"h3",9),a(72,"Reset Application"),t(),i(73,"p",14),a(74," Permanently delete your inventory data. CSV cache will be preserved to avoid re-downloading. "),t(),i(75,"button",30),g("click",function(){return e.clearAllData()}),a(76," Clear My Data Only "),t(),i(77,"p",14),a(78," Or permanently delete ALL data including the CSV cache (will force complete reload on next visit): "),t(),i(79,"button",31),g("click",function(){return e.clearAllDataIncludingCache()}),a(80," Clear All Data Including Cache "),t()()()(),m(81,W,33,15,"div",32),t()()()),r&2&&(s(5),l("ngIf",e.message),s(11),p("bg-blue-600",e.globalSettings.imagePreviewSize==="1x")("text-white",e.globalSettings.imagePreviewSize==="1x")("bg-gray-200",e.globalSettings.imagePreviewSize!=="1x")("text-gray-700",e.globalSettings.imagePreviewSize!=="1x"),s(2),p("bg-blue-600",e.globalSettings.imagePreviewSize==="2x")("text-white",e.globalSettings.imagePreviewSize==="2x")("bg-gray-200",e.globalSettings.imagePreviewSize!=="2x")("text-gray-700",e.globalSettings.imagePreviewSize!=="2x"),s(2),p("bg-blue-600",e.globalSettings.imagePreviewSize==="4x")("text-white",e.globalSettings.imagePreviewSize==="4x")("bg-gray-200",e.globalSettings.imagePreviewSize!=="4x")("text-gray-700",e.globalSettings.imagePreviewSize!=="4x"),s(8),p("bg-blue-600",e.globalSettings.includeSparePartsInProgress===!0)("text-white",e.globalSettings.includeSparePartsInProgress===!0)("bg-gray-200",e.globalSettings.includeSparePartsInProgress!==!0)("text-gray-700",e.globalSettings.includeSparePartsInProgress!==!0),s(2),p("bg-blue-600",e.globalSettings.includeSparePartsInProgress===!1)("text-white",e.globalSettings.includeSparePartsInProgress===!1)("bg-gray-200",e.globalSettings.includeSparePartsInProgress!==!1)("text-gray-700",e.globalSettings.includeSparePartsInProgress!==!1),s(18),l("disabled",!e.selectedFile),s(5),l("ngIf",e.isUsingIndexedDB),s(),l("ngIf",!e.isUsingIndexedDB),s(5),_(e.getCacheStatusClass()),s(),v(e.getCacheStatusText()),s(),l("ngIf",e.isUsingIndexedDB&&e.csvCacheInfo&&e.csvCacheInfo.exists),s(),l("ngIf",e.isUsingIndexedDB&&(!e.csvCacheInfo||!e.csvCacheInfo.exists)),s(),l("ngIf",!e.isUsingIndexedDB),s(),l("disabled",e.isRefreshingCSV),s(),l("ngIf",e.isRefreshingCSV),s(),f(" ",e.isRefreshingCSV?"Refreshing CSV Data...":"Refresh CSV Data from Server"," "),s(2),l("ngIf",e.isUsingIndexedDB),s(),l("ngIf",!e.isUsingIndexedDB),s(12),l("ngIf",e.isUsingIndexedDB&&e.storageInfo))},dependencies:[V,E,D,k,T,M],encapsulation:2})};export{F as SettingsComponent};
