import{d as ee}from"./chunk-6YWCPYRO.js";import{a as ne,b as ie,c as re,d as oe,e as se,f as ae,g as le}from"./chunk-ZFCMGSTD.js";import{a as de}from"./chunk-WP563T7B.js";import{$ as u,Aa as P,Ea as B,Eb as H,Fb as X,Gb as J,Hb as Q,Ia as x,Ib as Z,Oa as c,Pa as W,Qa as q,Qb as te,Ra as z,Sa as o,Ta as s,Ua as E,Xa as f,Ya as v,Za as m,_ as p,a as j,bb as S,c as O,cb as l,db as V,eb as h,gb as F,hb as T,ib as k,jb as M,lb as K,mb as Y,nb as N,ob as R,p as I,pb as b,rb as G,ua as C,wa as a}from"./chunk-JYGZRIUA.js";var _=[];for(let n=0;n<256;++n)_.push((n+256).toString(16).slice(1));function me(n,t=0){return(_[n[t+0]]+_[n[t+1]]+_[n[t+2]]+_[n[t+3]]+"-"+_[n[t+4]]+_[n[t+5]]+"-"+_[n[t+6]]+_[n[t+7]]+"-"+_[n[t+8]]+_[n[t+9]]+"-"+_[n[t+10]]+_[n[t+11]]+_[n[t+12]]+_[n[t+13]]+_[n[t+14]]+_[n[t+15]]).toLowerCase()}var D,ue=new Uint8Array(16);function L(){if(!D){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");D=crypto.getRandomValues.bind(crypto)}return D(ue)}var _e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),A={randomUUID:_e};function ve(n,t,e){if(A.randomUUID&&!t&&!n)return A.randomUUID();n=n||{};let i=n.random??n.rng?.()??L();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){if(e=e||0,e<0||e+16>t.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let r=0;r<16;++r)t[e+r]=i[r];return t}return me(i)}var $=ve;var xe=()=>[2023,2022,2021,2020,2019,2018,2017,2016,2015],fe=n=>["/inventory",n];function ye(n,t){if(n&1&&(o(0,"div",38)(1,"div",39)(2,"span"),l(3,"Progress"),s(),o(4,"span"),l(5),N(6,"number"),s()(),o(7,"div",40),E(8,"div",41),s()()),n&2){let e=t.ngIf;a(5),F("",e.totalOwned,"/",e.totalNeeded," parts (",R(6,11,e.progress,"1.1-1"),"%)"),a(3),W("width",e.progress,"%"),q("bg-green-500",e.progress>=100)("bg-yellow-500",e.progress>0&&e.progress<100)("bg-red-500",e.progress===0)}}function he(n,t){if(n&1){let e=f();o(0,"div",23)(1,"div",24)(2,"div",25)(3,"div",26),v("click",function(){let r=p(e).$implicit,d=m(2);return u(d.openImageOverlay(d.allInventorySetImageUrls[r.set_num]||"",r.name))}),o(4,"img",27),v("error",function(r){p(e);let d=m(2);return u(d.onImageError(r))}),s()()(),o(5,"div",28)(6,"p",29),l(7," Image \xA9 "),o(8,"a",30),l(9,"Rebrickable"),s()()(),o(10,"h3",31),l(11),s(),o(12,"p",32),l(13),s(),o(14,"p",32),l(15),s(),o(16,"p",33),l(17),N(18,"date"),s(),x(19,ye,9,14,"div",34),o(20,"div",35)(21,"a",36),l(22," View Inventory "),s(),o(23,"button",37),v("click",function(){let r=p(e).$implicit,d=m(2);return u(d.removeFromMyInventory(r.set_num,r.version))}),l(24," Remove "),s()()()()}if(n&2){let e=t.$implicit,i=m(2);a(4),c("src",i.allInventorySetImageUrls[e.set_num]||"",C)("alt",e.name),a(7),V(e.name),a(2),h("Set #: ",e.set_num,""),a(2),h("Version: ",e.version,""),a(2),h("Last updated: ",R(18,8,e.lastUpdated,"medium"),""),a(2),c("ngIf",i.getInventoryProgress(e)),a(2),c("routerLink",Y(11,fe,e.id))}}function Se(n,t){if(n&1&&(o(0,"div",21),x(1,he,25,13,"div",22),s()),n&2){let e=m();a(),c("ngForOf",e.userInventories)}}function be(n,t){n&1&&(o(0,"div",42)(1,"p",43),l(2,"You haven't added any sets to your collection yet."),s(),o(3,"p",44),l(4,"Browse and add sets from the list below."),s()())}function we(n,t){if(n&1&&(o(0,"option",17),l(1),s()),n&2){let e=t.$implicit;c("ngValue",e),a(),V(e)}}function Ie(n,t){if(n&1&&(o(0,"div",48),l(1),s()),n&2){let e=m(2);a(),F(" Showing ",(e.currentPage-1)*e.itemsPerPage+1," - ",e.Math.min(e.currentPage*e.itemsPerPage,e.filteredSets.length)," of ",e.filteredSets.length," sets ")}}function Ce(n,t){if(n&1){let e=f();o(0,"div")(1,"div",35)(2,"a",54),l(3," View Inventory "),s(),o(4,"button",37),v("click",function(){p(e);let r=m().$implicit,d=m(3);return u(d.removeFromMyInventory(r.set_num))}),l(5," Remove "),s()()()}if(n&2){let e=m().$implicit,i=m(3);a(2),c("routerLink",i.getInventoryLink(e.set_num))}}function Pe(n,t){if(n&1&&(o(0,"option",61),l(1),s()),n&2){let e=t.$implicit;c("value",e),a(),h("Version ",e,"")}}function Ee(n,t){if(n&1){let e=f();o(0,"div",57)(1,"label",58),l(2,"Select Version:"),s(),o(3,"select",59),M("ngModelChange",function(r){p(e);let d=m(2).$implicit,g=m(3);return k(g.selectedVersions[d.set_num],r)||(g.selectedVersions[d.set_num]=r),u(r)}),x(4,Pe,2,2,"option",60),s()()}if(n&2){let e=m(2).$implicit,i=m(3);a(3),T("ngModel",i.selectedVersions[e.set_num]),a(),c("ngForOf",e.versions)}}function Ve(n,t){if(n&1){let e=f();x(0,Ee,5,2,"div",55),o(1,"button",56),v("click",function(){p(e);let r=m().$implicit,d=m(3);return u(d.addToMyInventory(r,r.versions.length>1?d.selectedVersions[r.set_num]:1))}),l(2," Add to My Sets "),s()}if(n&2){let e=m().$implicit;c("ngIf",e.versions.length>1)}}function Te(n,t){if(n&1){let e=f();o(0,"div",23)(1,"div",24)(2,"div",25)(3,"div",50),v("click",function(){let r=p(e).$implicit,d=m(3);return u(d.openImageOverlay(r.img_url,r.name))}),o(4,"img",27),v("error",function(r){p(e);let d=m(3);return u(d.onImageError(r))}),s()()(),o(5,"div",28)(6,"p",29),l(7," Image \xA9 "),o(8,"a",30),l(9,"Rebrickable"),s()()(),o(10,"h3",51),l(11),s(),o(12,"p",52),l(13),s(),o(14,"p",52),l(15),s(),o(16,"p",53),l(17),s(),o(18,"p",53),l(19),s(),x(20,Ce,6,1,"div",19)(21,Ve,3,1,"ng-template",null,3,b),s()()}if(n&2){let e=t.$implicit,i=S(22),r=m(3);a(4),c("src",e.img_url,C)("alt",e.name),a(6),c("title",e.name),a(),V(e.name),a(2),h("Set #: ",e.set_num,""),a(2),h("Year: ",e.year,""),a(2),h("Parts: ",e.num_parts,""),a(2),h("Versions: ",e.versions.join(", "),""),a(),c("ngIf",r.isSetTracked(e.set_num))("ngIfElse",i)}}function ke(n,t){if(n&1&&(o(0,"div",49),x(1,Te,23,10,"div",22),s()),n&2){let e=m(2);a(),c("ngForOf",e.paginatedSets)}}function Me(n,t){if(n&1){let e=f();o(0,"button",65),v("click",function(){let r=p(e).$implicit,d=m(3);return u(d.goToPage(r))}),l(1),s()}if(n&2){let e=t.$implicit,i=m(3);z(e===i.currentPage?"px-3 py-2 rounded border bg-blue-600 text-white":"px-3 py-2 rounded border bg-white text-gray-700 hover:bg-gray-50"),a(),h(" ",e," ")}}function Ue(n,t){if(n&1){let e=f();o(0,"div",62)(1,"button",63),v("click",function(){p(e);let r=m(2);return u(r.previousPage())}),l(2," Previous "),s(),x(3,Me,2,3,"button",64),o(4,"button",63),v("click",function(){p(e);let r=m(2);return u(r.nextPage())}),l(5," Next "),s()()}if(n&2){let e=m(2);a(),c("disabled",e.currentPage===1),a(2),c("ngForOf",e.getPageNumbers()),a(),c("disabled",e.currentPage===e.totalPages)}}function Oe(n,t){if(n&1){let e=f();o(0,"div",42)(1,"p",43),l(2,"No sets found matching your criteria."),s(),o(3,"button",66),v("click",function(){p(e);let r=m(2);return u(r.clearFilters())}),l(4," Clear Filters "),s()()}}function Fe(n,t){if(n&1&&(o(0,"div"),x(1,Ie,2,3,"div",45)(2,ke,2,1,"div",46)(3,Ue,6,3,"div",47)(4,Oe,5,0,"ng-template",null,2,b),s()),n&2){let e=S(5),i=m();a(),c("ngIf",i.filteredSets.length>0),a(),c("ngIf",i.paginatedSets.length>0)("ngIfElse",e),a(),c("ngIf",i.totalPages>1)}}function Ne(n,t){n&1&&(o(0,"div",67),E(1,"div",68),o(2,"p",69),l(3,"Loading sets..."),s()())}function Re(n,t){if(n&1){let e=f();o(0,"div",70),v("click",function(r){p(e);let d=m();return u(d.onOverlayClick(r))}),o(1,"div",71)(2,"button",72),v("click",function(){p(e);let r=m();return u(r.closeImageOverlay())}),l(3," \xD7 "),s(),E(4,"img",73),o(5,"div",74)(6,"p",75),l(7," Image \xA9 "),o(8,"a",76),l(9,"Rebrickable"),s()()()()()}if(n&2){let e=m();a(4),c("src",e.getLargeImageUrl(e.overlayImageUrl),C)("alt",e.overlayImageAlt)}}var ce=class n{constructor(t,e,i){this.dataService=t;this.storageService=e;this.cdr=i}sets=[];userInventories=[];filteredSets=[];paginatedSets=[];searchTerm="";yearFilter=null;loading=!0;selectedVersions={};allInventoryProgress={};allInventorySetImageUrls={};globalSettings={imagePreviewSize:"1x",includeSparePartsInProgress:!0};currentPage=1;itemsPerPage=24;totalPages=0;totalCount=0;hasNext=!1;Math=Math;showImageOverlay=!1;overlayImageUrl="";overlayImageAlt="";ngOnInit(){this.storageService.getState().subscribe({next:t=>{this.userInventories=t.userInventories,this.globalSettings=j({},t.globalSettings),this.getAllInventoryProgress(),this.getAllInventorySetImageUrls()},error:t=>{console.error("Error loading user inventories:",t)}}),this.loadSetsPage()}loadSetsPage(){this.loading=!0;let t=this.dataService.getSetsPaginated(this.currentPage,this.itemsPerPage,this.searchTerm,this.yearFilter||void 0).subscribe({next:e=>{this.paginatedSets=e.sets,this.totalCount=e.totalCount,this.hasNext=e.hasNext,this.totalPages=Math.ceil(this.totalCount/this.itemsPerPage),this.paginatedSets.forEach(i=>{i.versions&&i.versions.length>0&&(this.selectedVersions[i.set_num]=i.versions[0])}),this.loading=!1},error:e=>{console.error("Sets component: Error loading sets page:",e),this.loading=!1,this.paginatedSets=[],this.totalCount=0,this.hasNext=!1,this.totalPages=0}})}filterSets(){this.currentPage=1,this.loadSetsPage()}clearFilters(){this.searchTerm="",this.yearFilter=null,this.filterSets()}goToPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,this.loadSetsPage())}nextPage(){this.goToPage(this.currentPage+1)}previousPage(){this.goToPage(this.currentPage-1)}getPageNumbers(){let t=[],i=Math.floor(2.5),r=Math.max(1,this.currentPage-i),d=Math.min(this.totalPages,r+5-1);d-r<4&&(r=Math.max(1,d-5+1));for(let g=r;g<=d;g++)t.push(g);return t}isSetTracked(t,e){return e?this.userInventories.some(i=>i.set_num===t&&i.version===e):this.userInventories.some(i=>i.set_num===t)}getInventoryLink(t){let e=this.userInventories.find(i=>i.set_num===t);return e?["/inventory",e.id]:["/sets"]}addToMyInventory(t,e=1){if(this.isSetTracked(t.set_num))return;let i={id:$(),set_num:t.set_num,version:e,name:t.name,partsOwned:{},minifigsOwned:{},minifigPartsOwned:{},lastUpdated:Date.now()};this.storageService.addUserInventory(i)}removeFromMyInventory(t,e=1){let i=this.userInventories.find(r=>r.set_num===t&&r.version===e);i&&this.storageService.deleteUserInventory(i.id)}getAllInventoryProgress(){return O(this,null,function*(){for(let t of this.userInventories){let e=`${t.set_num}_v${t.version}`;this.allInventoryProgress[e]=yield this.getInventoryProgressAsync(t)}})}getInventoryProgressAsync(t){return O(this,null,function*(){try{if(!(yield I(this.dataService.isDataLoaded())))return{totalOwned:0,totalNeeded:0,progress:0};let i=Number(t.version),[r,d]=yield Promise.all([I(this.dataService.getSetInventoryPartsBySetNum(t.set_num,i)),I(this.dataService.getSetInventoryMinifigsBySetNum(t.set_num,i))]),g=0,w=0;if(r)for(let y of r){if(!this.globalSettings.includeSparePartsInProgress&&y.is_spare)continue;let U=this.getPartStorageKey(y.part_num,y.color_id,y.is_spare),pe=t.partsOwned[U]||0;g+=y.quantity,w+=Math.min(pe,y.quantity)}if(d)for(let y of d){let U=t.minifigsOwned[y.fig_num]||0;g+=y.quantity,w+=Math.min(U,y.quantity)}let ge=g>0?w/g*100:0;return{totalOwned:w,totalNeeded:g,progress:ge}}catch(e){return console.error("Error calculating inventory progress:",e),{totalOwned:0,totalNeeded:0,progress:0}}})}getPartStorageKey(t,e,i){let r=`${t}_${e}`;return i?`spare_${r}`:r}getInventoryProgress(t){let e=`${t.set_num}_v${t.version}`;return this.allInventoryProgress[e]||{totalOwned:0,totalNeeded:0,progress:0}}getSetImageUrl(t){return this.paginatedSets.find(i=>i.set_num===t)?.img_url||""}getAllInventorySetImageUrls(){for(let t of this.userInventories)this.dataService.getSet(t.set_num).subscribe({next:e=>{this.allInventorySetImageUrls[t.set_num]=e?.img_url||"",this.cdr.detectChanges()},error:e=>{console.error("Error getting set image URL:",e),this.allInventorySetImageUrls[t.set_num]=""}})}onImageError(t){let e=t.target;e.src="assets/images/placeholder.svg"}openImageOverlay(t,e){this.overlayImageUrl=t,this.overlayImageAlt=e,this.showImageOverlay=!0,document.body.style.overflow="hidden"}closeImageOverlay(){this.showImageOverlay=!1,this.overlayImageUrl="",this.overlayImageAlt="",document.body.style.overflow="auto"}onOverlayClick(t){t.target===t.currentTarget&&this.closeImageOverlay()}getLargeImageUrl(t){return t.replace(/\/\d+x\d+\//,"/800x800/")||t}static \u0275fac=function(e){return new(e||n)(P(de),P(te),P(G))};static \u0275cmp=B({type:n,selectors:[["app-sets"]],decls:27,vars:10,consts:[["noUserSets",""],["loadingTemplate",""],["noSets",""],["addSetTemplate",""],[1,"py-8"],[1,"max-w-6xl","mx-auto"],[1,"bg-white","shadow-md","rounded-lg","p-6","mb-8"],[1,"text-2xl","font-bold","text-gray-800","mb-6"],["class","grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",4,"ngIf","ngIfElse"],[1,"text-3xl","font-bold","text-gray-800","mb-6"],[1,"flex","flex-col","md:flex-row","md:space-x-4","space-y-4","md:space-y-0","mb-8"],[1,"flex-1"],["for","search",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","search","placeholder","Search by name or set number",1,"px-4","py-2","border","rounded-md","w-full","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"w-full","md:w-1/4"],["for","year",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","year",1,"px-4","py-2","border","rounded-md","w-full","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["class","fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",3,"click",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-6"],["class","border rounded-lg overflow-hidden hover:shadow-lg transition",4,"ngFor","ngForOf"],[1,"border","rounded-lg","overflow-hidden","hover:shadow-lg","transition"],[1,"p-4"],[1,"mb-4","flex","justify-center"],[1,"w-24","h-24","bg-gray-100","rounded-lg","overflow-hidden","flex","items-center","justify-center","cursor-pointer",3,"click"],[1,"w-full","h-full","object-contain","hover:opacity-80","transition-opacity",3,"error","src","alt"],[1,"text-center","mb-3"],[1,"text-xs","text-gray-400"],["href","https://rebrickable.com","target","_blank","rel","noopener noreferrer",1,"text-blue-500","hover:text-blue-400"],[1,"font-bold","text-lg","mb-2"],[1,"text-gray-600","text-sm","mb-2"],[1,"text-gray-500","text-xs","mb-3"],["class","mb-4",4,"ngIf"],[1,"flex","space-x-2"],[1,"flex-1","bg-blue-600","text-white","px-3","py-2","rounded","text-sm","hover:bg-blue-700","transition","text-center",3,"routerLink"],[1,"bg-red-500","text-white","px-3","py-2","rounded","text-sm","hover:bg-red-600","transition",3,"click"],[1,"mb-4"],[1,"flex","justify-between","text-xs","text-gray-600","mb-1"],[1,"w-full","bg-gray-200","rounded-full","h-2"],[1,"h-2","rounded-full","transition-all","duration-300"],[1,"text-center","py-8"],[1,"text-lg","text-gray-600"],[1,"text-md","text-gray-500","mt-2"],["class","mb-4 text-sm text-gray-600",4,"ngIf"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8",4,"ngIf","ngIfElse"],["class","flex justify-center items-center space-x-2 mt-8",4,"ngIf"],[1,"mb-4","text-sm","text-gray-600"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-6","mb-8"],[1,"w-20","h-20","bg-gray-100","rounded-lg","overflow-hidden","flex","items-center","justify-center","cursor-pointer",3,"click"],[1,"font-bold","text-lg","mb-2","truncate",3,"title"],[1,"text-gray-600","text-sm","mb-1"],[1,"text-gray-600","text-sm","mb-3"],[1,"bg-blue-600","text-white","px-3","py-2","rounded","text-sm","hover:bg-blue-700","transition","flex-1","text-center",3,"routerLink"],["class","mb-2",4,"ngIf"],[1,"w-full","bg-green-600","text-white","px-3","py-2","rounded","text-sm","hover:bg-green-700","transition",3,"click"],[1,"mb-2"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"px-2","py-1","border","rounded-md","w-full","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","justify-center","items-center","space-x-2","mt-8"],[1,"px-3","py-2","rounded","border","bg-white","text-gray-700","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[3,"class","click",4,"ngFor","ngForOf"],[3,"click"],[1,"mt-4","bg-blue-600","text-white","px-4","py-2","rounded","hover:bg-blue-700","transition",3,"click"],[1,"flex","justify-center","items-center","h-64"],[1,"animate-spin","rounded-full","h-12","w-12","border-t-2","border-b-2","border-blue-600"],[1,"ml-4","text-lg","text-gray-600"],[1,"fixed","inset-0","bg-black","bg-opacity-75","flex","items-center","justify-center","z-50",3,"click"],[1,"relative","max-w-4xl","max-h-4xl","p-4"],[1,"absolute","top-2","right-2","text-white","hover:text-gray-300","text-2xl","font-bold","z-10","bg-black","bg-opacity-50","rounded-full","w-8","h-8","flex","items-center","justify-center",3,"click"],[1,"max-w-full","max-h-full","object-contain",2,"max-width","800px","max-height","800px",3,"src","alt"],[1,"absolute","bottom-2","left-2","right-2","bg-black","bg-opacity-75","text-white","text-xs","p-2","rounded"],[1,"text-center"],["href","https://rebrickable.com","target","_blank","rel","noopener noreferrer",1,"text-blue-300","hover:text-blue-100","underline"]],template:function(e,i){if(e&1){let r=f();o(0,"div",4)(1,"div",5)(2,"div",6)(3,"h2",7),l(4,"My Sets"),s(),x(5,Se,2,1,"div",8)(6,be,5,0,"ng-template",null,0,b),s(),o(8,"div",6)(9,"h1",9),l(10,"Browse Sets"),s(),o(11,"div",10)(12,"div",11)(13,"label",12),l(14,"Search"),s(),o(15,"input",13),M("ngModelChange",function(g){return p(r),k(i.searchTerm,g)||(i.searchTerm=g),u(g)}),v("ngModelChange",function(){return p(r),u(i.filterSets())}),s()(),o(16,"div",14)(17,"label",15),l(18,"Filter by Year"),s(),o(19,"select",16),M("ngModelChange",function(g){return p(r),k(i.yearFilter,g)||(i.yearFilter=g),u(g)}),v("ngModelChange",function(){return p(r),u(i.filterSets())}),o(20,"option",17),l(21,"All Years"),s(),x(22,we,2,2,"option",18),s()()(),x(23,Fe,6,4,"div",19)(24,Ne,4,0,"ng-template",null,1,b),s()()(),x(26,Re,10,2,"div",20)}if(e&2){let r=S(7),d=S(25);a(5),c("ngIf",i.userInventories.length>0)("ngIfElse",r),a(10),T("ngModel",i.searchTerm),a(4),T("ngModel",i.yearFilter),a(),c("ngValue",null),a(2),c("ngForOf",K(9,xe)),a(),c("ngIf",!i.loading)("ngIfElse",d),a(3),c("ngIf",i.showImageOverlay)}},dependencies:[Z,H,X,Q,J,ee,le,se,ae,ne,oe,ie,re],encapsulation:2})};export{ce as SetsComponent};
